{"version":3,"file":"l-signature.js","sources":["uni_modules/lime-signature/components/l-signature/l-signature.vue","/Users/yx/Documents/Vue3Projects/cycl/uni_modules/lime-signature/components/l-signature/l-signature.vue?type=component"],"sourcesContent":["<template>\r\n\t<view class=\"lime-signature\" v-if=\"show\" :style=\"[canvasStyle, styles]\" ref=\"limeSignature\">\r\n\t\t<!-- #ifndef APP-VUE || APP-NVUE -->\r\n\t\t<canvas v-if=\"useCanvas2d\" class=\"lime-signature__canvas\" :id=\"canvasId\" type=\"2d\"\r\n\t\t\t:disableScroll=\"disableScroll\" @touchstart=\"touchStart\" @touchmove=\"touchMove\"\r\n\t\t\t@touchend=\"touchEnd\"></canvas>\r\n\t\t<canvas v-else :disableScroll=\"disableScroll\" class=\"lime-signature__canvas\" :canvas-id=\"canvasId\"\r\n\t\t\t:id=\"canvasId\" :width=\"canvasWidth\" :height=\"canvasHeight\" @touchstart=\"touchStart\" @touchmove=\"touchMove\"\r\n\t\t\t@touchend=\"touchEnd\" @mousedown=\"touchStart\" @mousemove=\"touchMove\" @mouseup=\"touchEnd\"></canvas>\r\n\t\t<canvas v-if=\"showOffscreen\" class=\"offscreen\" canvas-id=\"offscreen\" id=\"offscreen\"\r\n\t\t\t:style=\"'width:' + offscreenSize[0] + 'px;height:' + offscreenSize[1] + 'px'\" :width=\"offscreenSize[0]\"\r\n\t\t\t:height=\"offscreenSize[1]\">\r\n\t\t</canvas>\r\n\t\t<view v-if=\"showMask\" class=\"mask\" @touchstart=\"touchStart\" @touchmove.stop.prevent=\"touchMove\"\r\n\t\t\t@touchend=\"touchEnd\"></view>\r\n\t\t<!-- #endif -->\r\n\t\t<!-- #ifdef APP-VUE -->\r\n\t\t<view :id=\"canvasId\" :disableScroll=\"disableScroll\" :rparam=\"param\" :change:rparam=\"sign.update\"\r\n\t\t\t:rclear=\"rclear\" :change:rclear=\"sign.clear\" :rundo=\"rundo\" :rredo=\"rredo\" :change:rredo=\"sign.redo\"\r\n\t\t\t:change:rundo=\"sign.undo\" :rsave=\"rsave\" :rmask=\"rmask\" :change:rsave=\"sign.save\" :change:rmask=\"sign.mask\"\r\n\t\t\t:rdestroy=\"rdestroy\" :change:rdestroy=\"sign.destroy\" :rempty=\"rempty\" :change:rempty=\"sign.isEmpty\">\r\n\t\t</view>\r\n\t\t<!-- #endif -->\r\n\t\t<!-- #ifdef APP-NVUE -->\r\n\t\t<web-view src=\"/uni_modules/lime-signature/hybrid/html/index.html\" class=\"lime-signature__canvas\" ref=\"webview\"\r\n\t\t\t@pagefinish=\"onPageFinish\" @error=\"onError\" @onPostMessage=\"onMessage\"></web-view>\r\n\t\t<!-- #endif -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\t/**\r\n\t * Signature 电子签名板组件\r\n\t * @description 用于实现手写签名功能，支持多种画笔设置和手势控制\r\n\t * <br>插件类型：LSignatureComponentPublicInstance \r\n\t * @tutorial https://ext.dcloud.net.cn/plugin?name=lime-signature\r\n\t * \r\n\t * @property {string} styles 画布容器样式\r\n\t * @property {string} penColor 画笔颜色\r\n\t * @property {number} penSize 画笔基础粗细\r\n\t * @property {string} backgroundColor 画布背景色\r\n\t * @property {boolean} openSmooth 启用笔迹平滑\r\n\t * @property {number} minLineWidth 最小笔触宽度\r\n\t * @property {number} maxLineWidth 最大笔触宽度\r\n\t * @property {number} minSpeed 最小绘制速度（像素/秒）\r\n\t * @property {number} maxWidthDiffRate 宽度变化率限制\r\n\t * @property {number} maxHistoryLength 撤销历史记录数\r\n\t * @property {boolean} disableScroll 禁止滚动穿透\r\n\t * @property {boolean} disabled 禁用签名板\r\n\t * @property {boolean} landscape 横屏模式\r\n\t * @event {Function} change 绘制内容变化时触发\r\n\t */\r\n\t\r\n\t// #ifndef APP-NVUE\r\n\timport { canIUseCanvas2d, wrapEvent, requestAnimationFrame, sleep, isTransparent} from './utils'\r\n\timport {Signature} from './signature.js'\r\n\t// import {Signature} from '@signature';\r\n\timport { uniContext, createImage, toDataURL} from './context'\r\n\t// #endif\r\n\timport props from './props';\r\n\timport { base64ToPath, getRect} from './utils'\r\n\r\n\texport default {\r\n\t\tprops,\r\n\t\t// emits: ['change'],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tcanvasWidth: null,\r\n\t\t\t\tcanvasHeight: null,\r\n\t\t\t\toffscreenWidth: null,\r\n\t\t\t\toffscreenHeight: null,\r\n\t\t\t\tuseCanvas2d: true,\r\n\t\t\t\tshow: true,\r\n\t\t\t\toffscreenStyles: '',\r\n\t\t\t\tshowMask: false,\r\n\t\t\t\tshowOffscreen: false,\r\n\t\t\t\tisPC: false,\r\n\t\t\t\tisCanvasEmpty: true,\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\trclear: 0,\r\n\t\t\t\trdestroy: 0,\r\n\t\t\t\trundo: 0,\r\n\t\t\t\trredo: 0,\r\n\t\t\t\trsave: JSON.stringify({\r\n\t\t\t\t\tn: 0,\r\n\t\t\t\t\tfileType: 'png',\r\n\t\t\t\t\tquality: 1,\r\n\t\t\t\t\tdestWidth: 0,\r\n\t\t\t\t\tdestHeight: 0,\r\n\t\t\t\t}),\r\n\t\t\t\trmask: JSON.stringify({\r\n\t\t\t\t\tn: 0,\r\n\t\t\t\t\tdestWidth: 0,\r\n\t\t\t\t\tdestHeight: 0,\r\n\t\t\t\t}),\r\n\t\t\t\trempty: 0,\r\n\t\t\t\trisEmpty: true,\r\n\t\t\t\ttoDataURL: null,\r\n\t\t\t\ttempFilePath: [],\r\n\t\t\t\t// #endif\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tcanvasId() {\r\n\t\t\t\t// #ifdef VUE2\r\n\t\t\t\treturn `lime-signature${this._uid}`\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef VUE3\r\n\t\t\t\treturn `lime-signature${this._.uid}`\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\toffscreenId() {\r\n\t\t\t\treturn this.canvasId + 'offscreen'\r\n\t\t\t},\r\n\t\t\toffscreenSize() {\r\n\t\t\t\tconst {\r\n\t\t\t\t\toffscreenWidth,\r\n\t\t\t\t\toffscreenHeight\r\n\t\t\t\t} = this\r\n\t\t\t\treturn this.landscape ? [offscreenHeight, offscreenWidth] : [offscreenWidth, offscreenHeight]\r\n\t\t\t},\r\n\t\t\tcanvasStyle() {\r\n\t\t\t\tconst {\r\n\t\t\t\t\tcanvasWidth,\r\n\t\t\t\t\tcanvasHeight,\r\n\t\t\t\t\tbackgroundColor\r\n\t\t\t\t} = this\r\n\t\t\t\treturn {\r\n\t\t\t\t\twidth: canvasWidth && (canvasWidth + 'px'),\r\n\t\t\t\t\theight: canvasHeight && (canvasHeight + 'px'),\r\n\t\t\t\t\tbackground: backgroundColor\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tparam() {\r\n\t\t\t\tconst {\r\n\t\t\t\t\tpenColor,\r\n\t\t\t\t\tpenSize,\r\n\t\t\t\t\tbackgroundColor,\r\n\t\t\t\t\tbackgroundImage,\r\n\t\t\t\t\tlandscape,\r\n\t\t\t\t\tboundingBox,\r\n\t\t\t\t\topenSmooth,\r\n\t\t\t\t\tminLineWidth,\r\n\t\t\t\t\tmaxLineWidth,\r\n\t\t\t\t\tminSpeed,\r\n\t\t\t\t\tmaxWidthDiffRate,\r\n\t\t\t\t\tmaxHistoryLength,\r\n\t\t\t\t\tdisableScroll,\r\n\t\t\t\t\tdisabled\r\n\t\t\t\t} = this\r\n\t\t\t\treturn JSON.parse(JSON.stringify({\r\n\t\t\t\t\tpenColor,\r\n\t\t\t\t\tpenSize,\r\n\t\t\t\t\tbackgroundColor,\r\n\t\t\t\t\tbackgroundImage,\r\n\t\t\t\t\tlandscape,\r\n\t\t\t\t\tboundingBox,\r\n\t\t\t\t\topenSmooth,\r\n\t\t\t\t\tminLineWidth,\r\n\t\t\t\t\tmaxLineWidth,\r\n\t\t\t\t\tminSpeed,\r\n\t\t\t\t\tmaxWidthDiffRate,\r\n\t\t\t\t\tmaxHistoryLength,\r\n\t\t\t\t\tdisableScroll,\r\n\t\t\t\t\tdisabled\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t},\r\n\t\t// #ifdef APP-NVUE\r\n\t\twatch: {\r\n\t\t\tparam(v) {\r\n\t\t\t\tthis.$refs.webview.evalJS(`update(${JSON.stringify(v)})`)\r\n\t\t\t}\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #ifndef APP-PLUS\r\n\t\tcreated() {\r\n\t\t\tconst {\r\n\t\t\t\tplatform\r\n\t\t\t} = uni.getSystemInfoSync()\r\n\t\t\tthis.isPC = /windows|mac/.test(platform)\r\n\t\t\tthis.useCanvas2d = this.type == '2d' && canIUseCanvas2d() && !this.isPC\r\n\t\t\t// #ifndef H5\r\n\t\t\tthis.showMask = this.isPC\r\n\t\t\t// #endif\r\n\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #ifndef APP-PLUS\r\n\t\tasync mounted() {\r\n\t\t\tif (this.beforeDelay) {\r\n\t\t\t\tawait sleep(this.beforeDelay)\r\n\t\t\t}\r\n\t\t\tconst config = await this.getContext()\r\n\t\t\tthis.signature = new Signature(config)\r\n\t\t\tthis.canvasEl = this.signature.canvas.get('el')\r\n\t\t\tthis.offscreenWidth = this.canvasWidth = this.signature.canvas.get('width')\r\n\t\t\tthis.offscreenHeight = this.canvasHeight = this.signature.canvas.get('height')\r\n\r\n\t\t\tthis.stopWatch = this.$watch('param', (v) => {\r\n\t\t\t\tthis.signature.pen.setOption(v)\r\n\t\t\t}, {\r\n\t\t\t\timmediate: true\r\n\t\t\t})\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #ifndef APP-PLUS\r\n\t\t// #ifdef VUE3\r\n\t\tbeforeUnmount() {\r\n\t\t\tthis.stopWatch && this.stopWatch()\r\n\t\t\tthis.signature.destroy()\r\n\t\t\tthis.signature = null\r\n\t\t\tthis.show = false;\r\n\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\tthis.rdestroy++\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #ifdef VUE2\r\n\t\tbeforeDestroy() {\r\n\t\t\tthis.stopWatch && this.stopWatch()\r\n\t\t\tthis.signature.destroy()\r\n\t\t\tthis.show = false;\r\n\t\t\tthis.signature = null\r\n\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\tthis.rdestroy++\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #endif\r\n\t\tmethods: {\r\n\t\t\tcheckAndEmitEmptyStatus() {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\t\t\tconst isEmpty = this.risEmpty\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifndef APP-VUE || APP-NVUE\r\n\t\t\t\t\tconst isEmpty = this.signature?.isEmpty() ?? true\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\tif (isEmpty != this.isCanvasEmpty) {\r\n\t\t\t\t\t\tthis.isCanvasEmpty = isEmpty\r\n\t\t\t\t\t\tthis.$emit('change', isEmpty)\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 0);\r\n\t\t\t},\r\n\t\t\t// #ifdef MP-QQ\r\n\t\t\t// toJSON() { return this },\r\n\t\t\t// #endif\r\n\t\t\t// #ifdef APP-PLUS\r\n\t\t\tonPageFinish() {\r\n\t\t\t\tthis.$refs.webview.evalJS(`update(${JSON.stringify(this.param)})`)\r\n\t\t\t},\r\n\t\t\tonMessage(e = {}) {\r\n\t\t\t\tconst {\r\n\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\tdata: [res]\r\n\t\t\t\t\t}\r\n\t\t\t\t} = e\r\n\t\t\t\tif (res.event?.save) {\r\n\t\t\t\t\tthis.toDataURL = res.event.save\r\n\t\t\t\t}\r\n\t\t\t\tif (res.event?.changeSize) {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight\r\n\t\t\t\t\t} = res.event.changeSize\r\n\t\t\t\t}\r\n\t\t\t\tif (res.event.hasOwnProperty('isEmpty')) {\r\n\t\t\t\t\tthis.risEmpty = res.event.isEmpty\r\n\t\t\t\t\tthis.checkAndEmitEmptyStatus()\r\n\t\t\t\t}\r\n\t\t\t\tif (res.event?.file) {\r\n\t\t\t\t\tthis.tempFilePath.push(res.event.file)\r\n\t\t\t\t\tif (this.tempFilePath.length > 7) {\r\n\t\t\t\t\t\tthis.tempFilePath.shift()\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif (res.event?.success) {\r\n\t\t\t\t\tif (res.event.success) {\r\n\t\t\t\t\t\tthis.tempFilePath.push(res.event.success)\r\n\t\t\t\t\t\tif (this.tempFilePath.length > 8) {\r\n\t\t\t\t\t\t\tthis.tempFilePath.shift()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.toDataURL = this.tempFilePath.join('')\r\n\t\t\t\t\t\tthis.tempFilePath = []\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$emit('fail', 'canvas no data')\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// #endif\r\n\t\t\tredo() {\r\n\t\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\t\tthis.rredo += 1\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\tthis.$refs.webview.evalJS(`redo()`)\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifndef APP-VUE\r\n\t\t\t\tif (this.signature){\r\n\t\t\t\t\tthis.signature.redo()\r\n\t\t\t\t}\r\n\t\t\t\tthis.checkAndEmitEmptyStatus()\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\trestore() {\r\n\t\t\t\tthis.redo()\r\n\t\t\t},\r\n\t\t\tundo() {\r\n\t\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\t\tthis.rundo += 1\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\tthis.$refs.webview.evalJS(`undo()`)\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifndef APP-VUE\r\n\t\t\t\tif (this.signature)\r\n\t\t\t\t\tthis.signature.undo()\r\n\t\t\t\tthis.checkAndEmitEmptyStatus()\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t},\r\n\t\t\tclear() {\r\n\t\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\t\tthis.rclear += 1\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\tthis.$refs.webview.evalJS(`clear()`)\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifndef APP-VUE\r\n\t\t\t\tif (this.signature)\r\n\t\t\t\t\tthis.signature.clear()\r\n\t\t\t\tthis.checkAndEmitEmptyStatus()\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tisEmpty() {\r\n\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\tthis.$refs.webview.evalJS(`isEmpty()`)\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\t\tthis.rempty += 1\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifndef APP-VUE || APP-NVUE\r\n\t\t\t\treturn this.signature.isEmpty()\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tasync canvasToMaskPath(param = {}) {\r\n\t\t\t\tconst isEmpty = this.isEmpty()\r\n\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\tthis.$refs.webview.evalJS(`mask(${JSON.stringify(param)})`)\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\t\tconst stopURLWatch = this.$watch('toDataURL', (v, n) => {\r\n\t\t\t\t\tif (v && v !== n) {\r\n\t\t\t\t\t\t// if(param.pathType == 'url') {\r\n\t\t\t\t\t\tbase64ToPath(v).then(res => {\r\n\t\t\t\t\t\t\tparam.success({\r\n\t\t\t\t\t\t\t\ttempFilePath: res,\r\n\t\t\t\t\t\t\t\tisEmpty: this.risEmpty\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// } else {\r\n\t\t\t\t\t\t// \tparam.success({tempFilePath: v,isEmpty: this.risEmpty })\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\tthis.toDataURL = ''\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstopURLWatch && stopURLWatch()\r\n\t\t\t\t})\r\n\t\t\t\tconst {\r\n\t\t\t\t\tfileType,\r\n\t\t\t\t\tquality\r\n\t\t\t\t} = param\r\n\t\t\t\tconst rmask = JSON.parse(this.rmask)\r\n\t\t\t\trmask.n++\r\n\t\t\t\trmask.destWidth = param.destWidth ?? 0\r\n\t\t\t\trmask.destHeight = param.destHeight ?? 0\r\n\t\t\t\t// rmask.fileType = fileType\r\n\t\t\t\t// rmask.quality = quality\r\n\t\t\t\tthis.rmask = JSON.stringify(rmask)\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifndef APP-VUE || APP-NVUE\r\n\t\t\t\tthis.showOffscreen = true\r\n\r\n\t\t\t\tlet width = this.signature.canvas.get('width')\r\n\t\t\t\tlet height = this.signature.canvas.get('height')\r\n\t\t\t\tlet pixelRatio = this.pixelRatio || uni.getSystemInfoSync().pixelRatio\r\n\t\t\t\t\r\n\t\t\t\tif (this.useCanvas2d) {\r\n\t\t\t\t\tthis.offscreenWidth = width * pixelRatio\r\n\t\t\t\t\tthis.offscreenHeight = height * pixelRatio\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.offscreenWidth = width\r\n\t\t\t\t\tthis.offscreenHeight = height\r\n\t\t\t\t}\r\n\t\t\t\tawait sleep(100)\r\n\t\t\t\tconst context = uni.createCanvasContext('offscreen', this)\r\n\t\t\t\tconst size = Math.max(this.offscreenWidth, this.offscreenHeight)\r\n\t\t\t\tconst success = (success) => param.success && param.success(success)\r\n\t\t\t\tconst fail = (fail) => param.fail && param.fail(fail)\r\n\r\n\t\t\t\tthis.signature.pen.getMaskedImageData((imageData) => {\r\n\t\t\t\t\tlet canvasPutImageData = (options, comp) => {\r\n\t\t\t\t\t\tif (uni.canvasPutImageData) {\r\n\t\t\t\t\t\t\tuni.canvasPutImageData(options, comp)\r\n\t\t\t\t\t\t} else if (context.putImageData) {\r\n\t\t\t\t\t\t\tcontext.putImageData(options)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcanvasPutImageData({\r\n\t\t\t\t\t\tcanvasId: 'offscreen',\r\n\t\t\t\t\t\tx: 0,\r\n\t\t\t\t\t\ty: 0,\r\n\t\t\t\t\t\twidth: width,\r\n\t\t\t\t\t\theight: height,\r\n\t\t\t\t\t\tdata: imageData,\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\tfail(err)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: (re) => {\r\n\t\t\t\t\t\t\ttoDataURL('offscreen', this, param).then((res) => {\r\n\t\t\t\t\t\t\t\tcontext.restore()\r\n\t\t\t\t\t\t\t\tcontext.clearRect(0, 0, size, size)\r\n\t\t\t\t\t\t\t\tthis.offscreenWidth = width\r\n\t\t\t\t\t\t\t\tthis.offscreenHeight = height\r\n\t\t\t\t\t\t\t\tthis.showOffscreen = false\r\n\t\t\t\t\t\t\t\tsuccess({\r\n\t\t\t\t\t\t\t\t\ttempFilePath: res,\r\n\t\t\t\t\t\t\t\t\tisEmpty\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this)\r\n\r\n\t\t\t\t})\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tcanvasToTempFilePath(param = {}) {\r\n\r\n\t\t\t\tconst isEmpty = this.isEmpty()\r\n\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\tthis.$refs.webview.evalJS(`save(${JSON.stringify(param)})`)\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef APP-VUE || APP-NVUE\r\n\t\t\t\tconst stopURLWatch = this.$watch('toDataURL', (v, n) => {\r\n\t\t\t\t\tif (v && v !== n) {\r\n\t\t\t\t\t\tif (this.preferToDataURL) {\r\n\t\t\t\t\t\t\tparam.success({\r\n\t\t\t\t\t\t\t\ttempFilePath: v,\r\n\t\t\t\t\t\t\t\tisEmpty: this.risEmpty\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbase64ToPath(v).then(res => {\r\n\t\t\t\t\t\t\t\tparam.success({\r\n\t\t\t\t\t\t\t\t\ttempFilePath: res,\r\n\t\t\t\t\t\t\t\t\tisEmpty: this.risEmpty\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.toDataURL = ''\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstopURLWatch && stopURLWatch()\r\n\t\t\t\t})\r\n\t\t\t\tconst {\r\n\t\t\t\t\tfileType,\r\n\t\t\t\t\tquality\r\n\t\t\t\t} = param\r\n\t\t\t\tconst rsave = JSON.parse(this.rsave)\r\n\t\t\t\trsave.n++\r\n\t\t\t\trsave.fileType = fileType\r\n\t\t\t\trsave.quality = quality\r\n\t\t\t\trsave.destWidth = param.destWidth ?? 0\r\n\t\t\t\trsave.destHeight = param.destHeight ?? 0\r\n\t\t\t\tthis.rsave = JSON.stringify(rsave)\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifndef APP-VUE || APP-NVUE\r\n\t\t\t\tconst useCanvas2d = this.useCanvas2d\r\n\t\t\t\tconst success = (success) => param.success && param.success(success)\r\n\t\t\t\tconst fail = (err) => param.fail && param.fail(err)\r\n\t\t\t\tconst {\r\n\t\t\t\t\tcanvas\r\n\t\t\t\t} = this.signature.canvas.get('el')\r\n\t\t\t\tconst {\r\n\t\t\t\t\tbackgroundColor,\r\n\t\t\t\t\tlandscape,\r\n\t\t\t\t\tboundingBox\r\n\t\t\t\t} = this\r\n\t\t\t\tlet width = this.signature.canvas.get('width')\r\n\t\t\t\tlet height = this.signature.canvas.get('height')\r\n\t\t\t\tlet x = 0\r\n\t\t\t\tlet y = 0\r\n\t\t\t\tconst devtools = uni.getSystemInfoSync().platform == 'devtools'\r\n\t\t\t\tlet preferToDataURL = this.preferToDataURL\r\n\t\t\t\tlet scale = 1\r\n\t\t\t\t// #ifdef MP-TOUTIAO\r\n\t\t\t\tscale = devtools ? uni.getSystemInfoSync().pixelRatio : scale\r\n\t\t\t\t// 由于抖音不支持canvasToTempFilePath故优先使用createOffscreenCanvas\r\n\t\t\t\tpreferToDataURL = true\r\n\t\t\t\t// #endif\r\n\t\t\t\tconst canvasToTempFilePath = async (image) => {\r\n\t\t\t\t\tconst createCanvasContext = () => {\r\n\t\t\t\t\t\tconst useOffscreen = (useCanvas2d && !!uni.createOffscreenCanvas && preferToDataURL)\r\n\t\t\t\t\t\tif (useOffscreen && !devtools) {\r\n\t\t\t\t\t\t\tconst offCanvas = uni.createOffscreenCanvas({\r\n\t\t\t\t\t\t\t\ttype: '2d'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\toffCanvas.width = this.offscreenSize[0] * scale\r\n\t\t\t\t\t\t\toffCanvas.height = this.offscreenSize[1] * scale\r\n\t\t\t\t\t\t\tconst context = offCanvas.getContext(\"2d\");\r\n\t\t\t\t\t\t\treturn [context, offCanvas]\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst context = uni.createCanvasContext('offscreen', this)\r\n\t\t\t\t\t\t\treturn [context]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (boundingBox && !this.isPC || landscape || backgroundColor && !isTransparent(\r\n\t\t\t\t\t\t\tbackgroundColor)) {\r\n\r\n\t\t\t\t\t\tthis.showOffscreen = true\r\n\t\t\t\t\t\tawait sleep(100)\r\n\t\t\t\t\t\tconst [context, offCanvas] = createCanvasContext()\r\n\t\t\t\t\t\tcontext.save()\r\n\t\t\t\t\t\tcontext.setTransform(1, 0, 0, 1, 0, 0)\r\n\t\t\t\t\t\tif (landscape) {\r\n\t\t\t\t\t\t\tcontext.translate(0, width * scale)\r\n\t\t\t\t\t\t\tcontext.rotate(-Math.PI / 2)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (backgroundColor && !isTransparent(backgroundColor)) {\r\n\t\t\t\t\t\t\tcontext.fillStyle = backgroundColor\r\n\t\t\t\t\t\t\tcontext.fillRect(0, 0, width, height)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (offCanvas) {\r\n\t\t\t\t\t\t\tconst img = canvas.createImage();\r\n\t\t\t\t\t\t\timg.src = image\r\n\t\t\t\t\t\t\timg.onload = () => {\r\n\t\t\t\t\t\t\t\tcontext.drawImage(img, 0, 0, width * scale, height * scale);\r\n\t\t\t\t\t\t\t\tconst tempFilePath = offCanvas.toDataURL()\r\n\t\t\t\t\t\t\t\tthis.showOffscreen = false\r\n\t\t\t\t\t\t\t\tsuccess({\r\n\t\t\t\t\t\t\t\t\ttempFilePath,\r\n\t\t\t\t\t\t\t\t\tisEmpty\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcontext.drawImage(image, 0, 0, width * scale, height * scale);\r\n\t\t\t\t\t\t\tcontext.draw(false, () => {\r\n\t\t\t\t\t\t\t\ttoDataURL('offscreen', this, param).then((res) => {\r\n\t\t\t\t\t\t\t\t\tconst size = Math.max(width, height)\r\n\t\t\t\t\t\t\t\t\tcontext.restore()\r\n\t\t\t\t\t\t\t\t\tcontext.clearRect(0, 0, size, size)\r\n\t\t\t\t\t\t\t\t\tthis.showOffscreen = false\r\n\t\t\t\t\t\t\t\t\tsuccess({\r\n\t\t\t\t\t\t\t\t\t\ttempFilePath: res,\r\n\t\t\t\t\t\t\t\t\t\tisEmpty\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsuccess({\r\n\t\t\t\t\t\t\ttempFilePath: image,\r\n\t\t\t\t\t\t\tisEmpty\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst next = async () => {\r\n\t\t\t\t\tif (this.offscreenWidth != width || this.offscreenHeight != height) {\r\n\t\t\t\t\t\tthis.offscreenWidth = width\r\n\t\t\t\t\t\tthis.offscreenHeight = height\r\n\t\t\t\t\t\tawait sleep(100)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\t\tconst param = {\r\n\t\t\t\t\t\tx,\r\n\t\t\t\t\t\ty,\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight,\r\n\t\t\t\t\t\tcanvas,\r\n\t\t\t\t\t\tpreferToDataURL\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\r\n\t\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\t\tconst param = {\r\n\t\t\t\t\t\tx,\r\n\t\t\t\t\t\ty,\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight,\r\n\t\t\t\t\t\tcanvas: useCanvas2d ? canvas : null,\r\n\t\t\t\t\t\tpreferToDataURL\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\ttoDataURL(this.canvasId, this, param).then(canvasToTempFilePath).catch(fail)\r\n\t\t\t\t}\r\n\t\t\t\t// PC端小程序获取不到 ImageData 数据，长度为0\r\n\t\t\t\tif (boundingBox && !this.isPC) {\r\n\t\t\t\t\tthis.signature.getContentBoundingBox(async res => {\r\n\t\t\t\t\t\tthis.offscreenWidth = width = res.width\r\n\t\t\t\t\t\tthis.offscreenHeight = height = res.height\r\n\r\n\t\t\t\t\t\tx = res.startX\r\n\t\t\t\t\t\ty = res.startY\r\n\r\n\t\t\t\t\t\tnext()\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext()\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\t// #ifndef APP-PLUS\r\n\t\t\tgetContext() {\r\n\t\t\t\treturn getRect(`#${this.canvasId}`, {\r\n\t\t\t\t\tcontext: this,\r\n\t\t\t\t\ttype: this.useCanvas2d ? 'fields' : 'boundingClientRect'\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\tlet {\r\n\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\theight,\r\n\t\t\t\t\t\t\tnode: canvas,\r\n\t\t\t\t\t\t\tleft,\r\n\t\t\t\t\t\t\ttop,\r\n\t\t\t\t\t\t\tright\r\n\t\t\t\t\t\t} = res\r\n\t\t\t\t\t\tlet pixelRatio = this.pixelRatio ?? uni.getSystemInfoSync().pixelRatio\r\n\t\t\t\t\t\tlet context;\r\n\t\t\t\t\t\tif (canvas) {\r\n\t\t\t\t\t\t\tcontext = canvas.getContext('2d')\r\n\t\t\t\t\t\t\tcanvas.width = width * pixelRatio;\r\n\t\t\t\t\t\t\tcanvas.height = height * pixelRatio;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpixelRatio = 1\r\n\t\t\t\t\t\t\tcontext = uniContext(this.canvasId, this)\r\n\t\t\t\t\t\t\tcanvas = {\r\n\t\t\t\t\t\t\t\tgetContext: (type) => type == '2d' ? context : null,\r\n\t\t\t\t\t\t\t\tcreateImage,\r\n\t\t\t\t\t\t\t\ttoDataURL: () => toDataURL(this.canvasId, this),\r\n\t\t\t\t\t\t\t\trequestAnimationFrame\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 支付宝小程序 使用stroke有个默认背景色\r\n\t\t\t\t\t\tcontext.clearRect(0, 0, width, height)\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tleft,\r\n\t\t\t\t\t\t\ttop,\r\n\t\t\t\t\t\t\tright,\r\n\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\theight,\r\n\t\t\t\t\t\t\tcontext,\r\n\t\t\t\t\t\t\tcanvas,\r\n\t\t\t\t\t\t\tpixelRatio\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetTouch(e) {\r\n\t\t\t\tif (this.isPC && this.canvasRect) {\r\n\t\t\t\t\te.touches = e.touches.map(item => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\tx: item.clientX - this.canvasRect.left,\r\n\t\t\t\t\t\t\ty: item.clientY - this.canvasRect.top,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\treturn e\r\n\t\t\t},\r\n\t\t\ttouchStart(e) {\r\n\t\t\t\tif (!this.canvasEl) return\r\n\t\t\t\tthis.isStart = true\r\n\t\t\t\t// 微信小程序PC端不支持事件，使用这方法模拟一下\r\n\t\t\t\tif (this.isPC) {\r\n\t\t\t\t\tgetRect(`#${this.canvasId}`, {\r\n\t\t\t\t\t\tcontext: this\r\n\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\tthis.canvasRect = res\r\n\t\t\t\t\t\tthis.canvasEl.dispatchEvent('touchstart', wrapEvent(this.getTouch(e)))\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis.canvasEl.dispatchEvent('touchstart', wrapEvent(e))\r\n\t\t\t},\r\n\t\t\ttouchMove(e) {\r\n\t\t\t\tif (!this.canvasEl || !this.isStart && this.canvasEl) return\r\n\t\t\t\tthis.canvasEl.dispatchEvent('touchmove', wrapEvent(this.getTouch(e)))\r\n\t\t\t},\r\n\t\t\ttouchEnd(e) {\r\n\t\t\t\tif (!this.canvasEl) return\r\n\t\t\t\tthis.isStart = false\r\n\t\t\t\tthis.canvasEl.dispatchEvent('touchend', wrapEvent(e))\r\n\t\t\t\tthis.checkAndEmitEmptyStatus()\r\n\t\t\t},\r\n\t\t\t// #endif\r\n\t\t}\r\n\t}\r\n</script>\r\n<!-- #ifdef APP-VUE -->\r\n<script module=\"sign\" lang=\"renderjs\">\r\n\timport sign from './render'\r\n\texport default sign\r\n</script>\r\n<!-- #endif -->\r\n<style lang=\"scss\">\r\n\t.lime-signature,\r\n\t.lime-signature__canvas {\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\t/* #endif */\r\n\t\t/* #ifdef APP-NVUE */\r\n\t\tflex: 1;\r\n\t\t/* #endif */\r\n\t}\r\n\r\n\t.mask {\r\n\t\tposition: absolute;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\ttop: 0;\r\n\t}\r\n\r\n\t.offscreen {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\t// left: 0;\r\n\t\tpointer-events: none;\r\n\t\t// background: rgba(0,255,0,0.5);\r\n\t\tleft: 9999px;\r\n\t}\r\n</style>","import Component from '/Users/yx/Documents/Vue3Projects/cycl/uni_modules/lime-signature/components/l-signature/l-signature.vue'\nwx.createComponent(Component)"],"names":["props","uni","canIUseCanvas2d","sleep","Signature","success","fail","toDataURL","isTransparent","param","getRect","uniContext","createImage","requestAnimationFrame","wrapEvent"],"mappings":"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"}