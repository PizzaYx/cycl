{"version":3,"file":"syAllMap.js","sources":["pages/collection/syAllMap.vue","pages/collection/syAllMap.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"container\">\n        <PageHeader title=\"Êî∂ËøêÂú∞ÂõæËØ¶ÊÉÖ\" @back=\"back\" />\n\n        <view class=\"map-container\">\n            <map id=\"navigationMap\" class=\"navigation-map\" :scale=\"mapScale\" :markers=\"mapMarkers\"\n                :polyline=\"mapPolyline\" :show-location=\"true\" :enable-zoom=\"true\" :enable-scroll=\"true\"\n                :latitude=\"mapCenter.latitude\" :longitude=\"mapCenter.longitude\"></map>\n\n            <!-- ÂÆö‰ΩçÁä∂ÊÄÅÊèêÁ§∫ -->\n            <view class=\"location-status\" v-if=\"isLocating && isFirstLocation\">\n                <uni-icons type=\"spinner-cycle\" size=\"20\" color=\"#07C160\"></uni-icons>\n                <text class=\"status-text\">Ê≠£Âú®ÂÆö‰ΩçÂíåËßÑÂàíË∑ØÁ∫ø...</text>\n            </view>\n\n        </view>\n\n        <view class=\"bottom-section\">\n            <view class=\"driver-info-card\">\n                <view class=\"info-item\">\n                    <view class=\"avatar\">\n                        <view class=\"avatar-text\">{{ userStore.userSFAvatar }}</view>\n                    </view>\n                    <view class=\"name-info\">\n                        <text class=\"label\">Âè∏Êú∫ÂßìÂêçÔºö</text>\n                        <text class=\"value\">{{ driverName }}</text>\n                    </view>\n                </view>\n\n                <view class=\"divider\"></view>\n\n                <view class=\"driver-details\">\n                    <view class=\"detail-item\">\n                        <text class=\"label\">ËΩ¶ÁâåÂè∑Ôºö</text>\n                        <text class=\"value\">{{ registrationNumber }}</text>\n                    </view>\n                    <view class=\"detail-item\">\n                        <text class=\"label\">Êî∂ËøêÊÄªÈáçÈáèÔºö</text>\n                        <text class=\"value\">{{ totalEstimateWeight }}kg</text>\n                    </view>\n                    <view class=\"detail-item\">\n                        <text class=\"label\">ÂûÉÂúæÊ°∂Êï∞Ôºö</text>\n                        <text class=\"value\">{{ totalBucketNum }}‰∏™</text>\n                    </view>\n                    <view class=\"detail-item\">\n                        <text class=\"label\">Êî∂ËøêÊó•ÊúüÔºö</text>\n                        <text class=\"value\">{{ currentDate }}</text>\n                    </view>\n                </view>\n            </view>\n\n        </view>\n    </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, onUnmounted, nextTick } from 'vue'\nimport { useUserStore } from '@/stores/user.js'\nimport { onLoad } from '@dcloudio/uni-app'; // Ê≠£Á°ÆÂØºÂÖ•onLoadÁîüÂëΩÂë®Êúü\nimport { TIANDITU_CONFIG } from '@/utils/config.js' // ÂØºÂÖ•Â§©Âú∞ÂõæÈÖçÁΩÆ\nimport gcoord from 'gcoord' // ÂØºÂÖ•ÂùêÊ†áËΩ¨Êç¢Â∫ì\nimport PageHeader from '@/components/PageHeader/PageHeader.vue'\nconst userStore = useUserStore()\n\n// Âú∞ÂõæÁõ∏ÂÖ≥Êï∞ÊçÆ\nconst mapScale = ref(14) // ÊèêÈ´òÁº©ÊîæÁ∫ßÂà´ÔºåÊõ¥Ê∏ÖÊ•öÊòæÁ§∫ÂΩìÂâç‰ΩçÁΩÆ\nconst mapMarkers = ref([])\nconst mapPolyline = ref([])\nconst mapCenter = ref({\n    latitude: 30.6586, // ÊàêÈÉΩÂ∏Ç‰∏≠ÂøÉÂùêÊ†á\n    longitude: 104.0647\n})\n\n// Êé•Êî∂ÁöÑÂèÇÊï∞Êï∞ÊçÆ\nconst taskList = ref([])\nconst driverName = ref('')\nconst registrationNumber = ref('')\nconst bucketNum = ref(0)\nconst currentDate = ref('')\n\n// ÂÆö‰ΩçÁõ∏ÂÖ≥Áä∂ÊÄÅ\nconst isLocating = ref(false)\nconst currentLocation = ref({\n    latitude: 0,\n    longitude: 0,\n    accuracy: 0\n})\n\n// ÊåÅÁª≠ÂÆö‰ΩçÁõ∏ÂÖ≥\nconst locationTimer = ref(null)\nconst isContinuousLocation = ref(false)\nconst isFirstLocation = ref(true) // Ê†áËÆ∞ÊòØÂê¶‰∏∫Á¨¨‰∏ÄÊ¨°ÂÆö‰Ωç\n\n// Ê∑ªÂä†‰∏Ä‰∏™Ê†áÂøó‰ΩçÔºåË°®Á§∫Êï∞ÊçÆÊòØÂê¶Â∑≤Êé•Êî∂\nconst isDataReceived = ref(false)\n\n// ËÆ°ÁÆóÊÄªÈáçÈáè\nconst totalEstimateWeight = computed(() => {\n    return taskList.value.reduce((total, task) => {\n        return total + (parseFloat(task.weight) || 0)\n    }, 0).toFixed(1)\n})\n\n//ËÆ°ÁÆóÂ∑≤Êî∂ÂûÉÂúæÊ°∂Êï∞\nconst totalBucketNum = computed(() => {\n    return taskList.value.reduce((total, task) => {\n        return total + (parseFloat(task.bucketNum) || 0)\n    }, 0)\n})\n\n\n// ‰ΩøÁî®UniAppÂÆö‰Ωç\nconst useUniAppLocation = () => {\n    console.log('ÂºÄÂßãÂÆö‰Ωç...')\n    isLocating.value = true\n\n    // ÂÖàÊ£ÄÊü•ÂÆö‰ΩçÊùÉÈôê\n    checkLocationPermission()\n}\n\n// ÂºÄÂßãÊåÅÁª≠ÂÆö‰Ωç\nconst startContinuousLocation = () => {\n    console.log('ÂºÄÂßãÊåÅÁª≠ÂÆö‰ΩçÔºåÈó¥Èöî20Áßí')\n    isContinuousLocation.value = true\n\n    // Á´ãÂç≥ÊâßË°å‰∏ÄÊ¨°ÂÆö‰Ωç\n    useUniAppLocation()\n\n    // ËÆæÁΩÆÂÆöÊó∂Âô®ÔºåÊØè20ÁßíÂÆö‰Ωç‰∏ÄÊ¨°\n    locationTimer.value = setInterval(() => {\n        if (isContinuousLocation.value) {\n            console.log('ÂÆöÊó∂ÂÆö‰ΩçËß¶Âèë')\n            useUniAppLocation()\n        }\n    }, 20000) // 20Áßí = 20000ÊØ´Áßí\n}\n\n// ÂÅúÊ≠¢ÊåÅÁª≠ÂÆö‰Ωç\nconst stopContinuousLocation = () => {\n    console.log('ÂÅúÊ≠¢ÊåÅÁª≠ÂÆö‰Ωç')\n    isContinuousLocation.value = false\n\n    if (locationTimer.value) {\n        clearInterval(locationTimer.value)\n        locationTimer.value = null\n    }\n}\n\n// Ê£ÄÊü•ÂÆö‰ΩçÊùÉÈôê\nconst checkLocationPermission = () => {\n    uni.getSetting({\n        success: (res) => {\n            console.log('Ëé∑ÂèñÊùÉÈôêËÆæÁΩÆ:', res.authSetting)\n\n            if (res.authSetting['scope.userLocation'] === false) {\n                // Áî®Êà∑ÊãíÁªùËøáÂÆö‰ΩçÊùÉÈôêÔºåÈúÄË¶ÅÂºïÂØºÁî®Êà∑ÊâãÂä®ÂºÄÂêØ\n                uni.showModal({\n                    title: 'ÂÆö‰ΩçÊùÉÈôê',\n                    content: 'ÈúÄË¶ÅËé∑ÂèñÊÇ®ÁöÑÂú∞ÁêÜ‰ΩçÁΩÆÔºåËØ∑ÂâçÂæÄËÆæÁΩÆÈ°µÈù¢ÂºÄÂêØÂÆö‰ΩçÊùÉÈôê',\n                    showCancel: true,\n                    confirmText: 'ÂéªËÆæÁΩÆ',\n                    success: (modalRes) => {\n                        if (modalRes.confirm) {\n                            uni.openSetting({\n                                success: (settingRes) => {\n                                    if (settingRes.authSetting['scope.userLocation']) {\n                                        // Áî®Êà∑ÂºÄÂêØ‰∫ÜÊùÉÈôêÔºåÈáçÊñ∞ÂÆö‰Ωç\n                                        startUniAppLocation()\n                                    } else {\n                                        isLocating.value = false\n                                    }\n                                }\n                            })\n                        } else {\n                            isLocating.value = false\n                        }\n                    }\n                })\n            } else {\n                // ÊùÉÈôêÊ≠£Â∏∏ÊàñÊú™ËÆæÁΩÆÔºåÁõ¥Êé•ÂÆö‰Ωç\n                startUniAppLocation()\n            }\n        },\n        fail: () => {\n            // Ëé∑ÂèñËÆæÁΩÆÂ§±Ë¥•ÔºåÁõ¥Êé•Â∞ùËØïÂÆö‰Ωç\n            startUniAppLocation()\n        }\n    })\n}\n\n// ÂºÄÂßãUniAppÂÆö‰Ωç\nconst startUniAppLocation = () => {\n    uni.getLocation({\n        type: 'gcj02', // Áõ¥Êé•Ëé∑ÂèñGCJ02ÂùêÊ†áÁ≥ªÁöÑ‰ΩçÁΩÆ\n        altitude: false, // ‰∏çÈúÄË¶ÅÈ´òÂ∫¶‰ø°ÊÅØ\n        success: (res) => {\n            const lat = res.latitude\n            const lng = res.longitude\n\n            console.log('ÂÆö‰ΩçÊàêÂäü(GCJ02):', lat, lng)\n\n            // Êõ¥Êñ∞ÂΩìÂâç‰ΩçÁΩÆ\n            currentLocation.value = {\n                latitude: lat,\n                longitude: lng,\n                accuracy: res.accuracy || 100\n            }\n\n            // Êõ¥Êñ∞Âú∞Âõæ‰∏≠ÂøÉÁÇπ\n            mapCenter.value.latitude = lat\n            mapCenter.value.longitude = lng\n\n            console.log('Âú∞Âõæ‰∏≠ÂøÉÁÇπÂ∑≤Êõ¥Êñ∞‰∏∫:', lat, lng)\n\n            // Áõ¥Êé•ÊâßË°åÔºå‰∏ç‰ΩøÁî®nextTick\n            setTimeout(() => {\n                // Ê∑ªÂä†ÂΩìÂâç‰ΩçÁΩÆÊ†áËÆ∞\n                addCurrentLocationMarker(lat, lng)\n\n                // Ê∑ªÂä†‰ªªÂä°Âú∞ÁÇπÊ†áËÆ∞\n                addTaskMarkers()\n\n                // ÁªòÂà∂Ë∑ØÁ∫øÂíåËßÑÂàíË∑ØÂæÑ\n                planRoute()\n\n                isLocating.value = false\n\n                // Âè™Âú®Á¨¨‰∏ÄÊ¨°ÂÆö‰ΩçÊàêÂäüÊó∂ÊòæÁ§∫ÊèêÁ§∫\n                if (isFirstLocation.value) {\n                    uni.showToast({\n                        title: 'ÂÆö‰ΩçÊàêÂäüÔºåË∑ØÁ∫øËßÑÂàíÂÆåÊàê',\n                        icon: 'success'\n                    })\n                    isFirstLocation.value = false // Ê†áËÆ∞Á¨¨‰∏ÄÊ¨°ÂÆö‰ΩçÂÆåÊàê\n                } else {\n                    console.log('ÊåÅÁª≠ÂÆö‰ΩçÊõ¥Êñ∞ÊàêÂäüÔºåË∑ØÁ∫øÂ∑≤ÈáçÊñ∞ËßÑÂàí')\n                }\n            }, 100)\n        },\n        fail: (error) => {\n            console.error('ÂÆö‰ΩçÂ§±Ë¥•:', error)\n            isLocating.value = false\n\n            // Ê†πÊçÆÈîôËØØÁ±ªÂûãÁªôÂá∫‰∏çÂêåÊèêÁ§∫\n            let errorMsg = 'ÂÆö‰ΩçÂ§±Ë¥•'\n            if (error.errMsg) {\n                if (error.errMsg.includes('auth deny')) {\n                    errorMsg = 'ÂÆö‰ΩçÊùÉÈôêË¢´ÊãíÁªùÔºåËØ∑ÂºÄÂêØÂÆö‰ΩçÊùÉÈôê'\n                } else if (error.errMsg.includes('location fail')) {\n                    errorMsg = 'ÂÆö‰ΩçÊúçÂä°‰∏çÂèØÁî®ÔºåËØ∑Ê£ÄÊü•ÊâãÊú∫ÂÆö‰ΩçËÆæÁΩÆ'\n                } else {\n                    errorMsg = 'ÂÆö‰ΩçÂ§±Ë¥•Ôºö' + error.errMsg\n                }\n            }\n\n            uni.showModal({\n                title: 'ÂÆö‰ΩçÂ§±Ë¥•',\n                content: errorMsg,\n                showCancel: true,\n                confirmText: 'ÈáçËØï',\n                cancelText: 'ÂèñÊ∂à',\n                success: (modalRes) => {\n                    if (modalRes.confirm) {\n                        // Áî®Êà∑ÈÄâÊã©ÈáçËØï\n                        setTimeout(() => {\n                            useUniAppLocation()\n                        }, 1000)\n                    } else {\n                        // ‰ΩøÁî®ÈªòËÆ§‰ΩçÁΩÆÔºàÊàêÈÉΩÂ∏Ç‰∏≠ÂøÉÔºâ\n                        useDefaultLocation()\n                    }\n                }\n            })\n        }\n    })\n}\n\n// ‰ΩøÁî®ÈªòËÆ§‰ΩçÁΩÆ\nconst useDefaultLocation = () => {\n    console.log('‰ΩøÁî®ÈªòËÆ§‰ΩçÁΩÆÔºàÊàêÈÉΩÂ∏Ç‰∏≠ÂøÉÔºâ')\n    const defaultLat = 30.6586\n    const defaultLng = 104.0647\n\n    currentLocation.value = {\n        latitude: defaultLat,\n        longitude: defaultLng,\n        accuracy: 1000\n    }\n\n    mapCenter.value.latitude = defaultLat\n    mapCenter.value.longitude = defaultLng\n\n    console.log('Âú∞Âõæ‰∏≠ÂøÉÁÇπÂ∑≤Êõ¥Êñ∞‰∏∫ÈªòËÆ§‰ΩçÁΩÆ:', defaultLat, defaultLng)\n\n    // Áõ¥Êé•ÊâßË°åÔºå‰∏ç‰ΩøÁî®nextTick\n    setTimeout(() => {\n        // Ê∑ªÂä†ÈªòËÆ§‰ΩçÁΩÆÊ†áËÆ∞\n        addCurrentLocationMarker(defaultLat, defaultLng)\n\n        // Ê∑ªÂä†‰ªªÂä°Âú∞ÁÇπÊ†áËÆ∞\n        addTaskMarkers()\n\n        // ÁªòÂà∂Ë∑ØÁ∫øÂíåËßÑÂàíË∑ØÂæÑ\n        planRoute()\n\n        // uni.showToast({\n        //     title: '‰ΩøÁî®ÈªòËÆ§‰ΩçÁΩÆÔºåË∑ØÁ∫øËßÑÂàíÂÆåÊàê',\n        //     icon: 'none'\n        // })\n    }, 100)\n}\n\n// Ê∑ªÂä†ÂΩìÂâç‰ΩçÁΩÆÊ†áËÆ∞\nconst addCurrentLocationMarker = (lat, lng) => {\n    const marker = {\n        id: 0, // ‰ΩøÁî®Êï∞Â≠óID\n        latitude: lat,\n        longitude: lng,\n        title: 'ÂΩìÂâç‰ΩçÁΩÆ',\n        iconPath: '/static/ssd/positioning.png',\n        width: 30,\n        height: 30,\n        callout: {\n            content: 'ÂΩìÂâç‰ΩçÁΩÆ',\n            color: '#000000',\n            fontSize: 12,\n            borderRadius: 5,\n            bgColor: '#ffffff',\n            padding: 5,\n            display: 'ALWAYS'\n        }\n    }\n\n    mapMarkers.value = [marker] // ÂÖàÊ∏ÖÁ©∫ÂÜçÊ∑ªÂä†\n}\n\n// Ê∑ªÂä†‰ªªÂä°Âú∞ÁÇπÊ†áËÆ∞\nconst addTaskMarkers = () => {\n    taskList.value.forEach((task, index) => {\n        // ‰ΩøÁî®‰ªªÂä°Êï∞ÊçÆ‰∏≠ÁöÑÁúüÂÆûÁªèÁ∫¨Â∫¶\n        const taskLat = parseFloat(task.lat)\n        const taskLon = parseFloat(task.lon)\n\n        // È™åËØÅÁªèÁ∫¨Â∫¶ÊòØÂê¶ÊúâÊïà\n        if (isNaN(taskLat) || isNaN(taskLon)) {\n            console.warn(`‰ªªÂä° ${task.merchantName} ÁöÑÁªèÁ∫¨Â∫¶Êó†Êïà:`, task.lat, task.lon)\n            return\n        }\n\n        const marker = {\n            id: index + 1, // ‰ΩøÁî®Êï∞Â≠óIDÔºå‰ªé1ÂºÄÂßãÔºà0Â∑≤Ë¢´ÂΩìÂâç‰ΩçÁΩÆ‰ΩøÁî®Ôºâ\n            latitude: taskLat,\n            longitude: taskLon,\n            title: task.merchantName,\n            iconPath: '/static/ssd/positioning.png',\n            width: 25,\n            height: 25,\n            callout: {\n                content: task.merchantName,\n                color: '#000000',\n                fontSize: 12,\n                borderRadius: 5,\n                bgColor: '#ffffff',\n                padding: 5,\n                display: 'ALWAYS'\n            }\n        }\n\n        mapMarkers.value.push(marker)\n    })\n}\n\n\n// ‰ΩøÁî®Â§©Âú∞ÂõæAPIËøõË°åË∑ØÁ∫øËßÑÂàí\nconst planRoute = async () => {\n\n    if (mapMarkers.value.length < 1) {\n        console.log('Ê†áËÆ∞Êï∞Èáè‰∏çË∂≥ÔºåÊó†Ê≥ïËøõË°åË∑ØÁ∫øËßÑÂàí')\n        return\n    }\n\n    try {\n        // Ëµ∑ÁÇπÔºöÂΩìÂâç‰ΩçÁΩÆÔºàÁ¨¨‰∏Ä‰∏™Ê†áËÆ∞ÁÇπÔºåID‰∏∫0Ôºâ\n        const startPoint = mapMarkers.value.find(marker => marker.id === 0)\n        if (!startPoint) {\n            console.error('Êâæ‰∏çÂà∞Ëµ∑ÁÇπÔºàÂΩìÂâç‰ΩçÁΩÆÔºâ')\n            return\n        }\n\n        // ‰ªªÂä°ÁÇπÔºöÈô§‰∫ÜËµ∑ÁÇπ‰πãÂ§ñÁöÑÊâÄÊúâÁÇπ\n        const taskPoints = mapMarkers.value.filter(marker => marker.id !== 0)\n\n        if (taskPoints.length === 0) {\n            console.log('Ê≤°Êúâ‰ªªÂä°ÁÇπÔºåÊó†Ê≥ïËßÑÂàíË∑ØÁ∫ø')\n            return\n        }\n\n        console.log('ÂºÄÂßãË∑ØÁ∫øËßÑÂàí - ‰ªªÂä°ÁÇπÊï∞Èáè:', taskPoints.length)\n\n        // Â∞ÜGCJ02ÂùêÊ†áËΩ¨Êç¢‰∏∫WGS84ÂùêÊ†áÔºàÂ§©Âú∞Âõæ‰ΩøÁî®WGS84Ôºâ\n        const startWgs84Coord = gcoord.transform([startPoint.longitude, startPoint.latitude], gcoord.GCJ02, gcoord.WGS84)\n\n        let midWgs84Coords = []\n        let endWgs84Coord = null\n\n        if (taskPoints.length === 1) {\n            // Âè™Êúâ1‰∏™‰ªªÂä°ÁÇπÔºöÁõ¥Êé•‰Ωú‰∏∫ÁªàÁÇπ\n            endWgs84Coord = gcoord.transform([taskPoints[0].longitude, taskPoints[0].latitude], gcoord.GCJ02, gcoord.WGS84)\n        } else {\n            // Â§ö‰∏™‰ªªÂä°ÁÇπÔºöÊúÄÂêé‰∏Ä‰∏™‰Ωú‰∏∫ÁªàÁÇπÔºåÂÖ∂‰ªñ‰Ωú‰∏∫ÈÄîÁªèÁÇπ\n            const endPoint = taskPoints[taskPoints.length - 1]\n            const midPoints = taskPoints.slice(0, -1)\n\n            endWgs84Coord = gcoord.transform([endPoint.longitude, endPoint.latitude], gcoord.GCJ02, gcoord.WGS84)\n            midWgs84Coords = midPoints.map(point =>\n                gcoord.transform([point.longitude, point.latitude], gcoord.GCJ02, gcoord.WGS84)\n            )\n\n            console.log('ÈÄîÁªèÁÇπÊï∞Èáè:', midPoints.length)\n        }\n\n        // ÊòæÁ§∫Ë∑ØÁ∫øËßÑÂàí‰ø°ÊÅØ\n        const routeInfo = taskPoints.length === 1 ?\n            `ËßÑÂàíÁõ¥ËææË∑ØÁ∫øÔºöËµ∑ÁÇπ ‚Üí ${taskPoints[0].title}` :\n            `ËßÑÂàíÂ§öÁÇπË∑ØÁ∫øÔºöËµ∑ÁÇπ ‚Üí ${taskPoints.slice(0, -1).map(p => p.title).join(' ‚Üí ')} ‚Üí ${taskPoints[taskPoints.length - 1].title}`\n\n        console.log(routeInfo)\n        // uni.showLoading({\n        //     title: 'Ê≠£Âú®ËßÑÂàíË∑ØÁ∫ø...'\n        // })\n\n        // Ë∞ÉÁî®Â§©Âú∞ÂõæË∑ØÂæÑËßÑÂàíAPI\n        const routeData = await callTiandituRouteAPI(startWgs84Coord, endWgs84Coord, midWgs84Coords)\n\n        if (routeData && typeof routeData === 'string' && routeData.includes('<result')) {\n            // Â§©Âú∞ÂõæËøîÂõûXMLÊ†ºÂºèÔºåÈúÄË¶ÅËß£Êûê\n            parseRouteXML(routeData)\n        } else {\n            console.log('Â§©Âú∞ÂõæAPIËøîÂõûÊï∞ÊçÆÊ†ºÂºèÂºÇÂ∏∏')\n        }\n    } catch (error) {\n        if (typeof error === 'string' && error.includes('<result')) {\n            // APIËøîÂõû‰∫ÜXMLÊï∞ÊçÆÔºå‰ΩÜË¢´ÂΩì‰ΩúÈîôËØØÂ§ÑÁêÜ\n            parseRouteXML(error)\n        } else {\n            console.error('Ë∑ØÁ∫øËßÑÂàíÂ§±Ë¥•:', error.message || error)\n            uni.showToast({\n                title: 'Ë∑ØÁ∫øËßÑÂàíÂ§±Ë¥•',\n                icon: 'none'\n            })\n        }\n    } finally {\n        // Á°Æ‰øùÂÖ≥Èó≠Âä†ËΩΩÊèêÁ§∫\n        uni.hideLoading()\n    }\n}\n\n// ‰ΩøÁî®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑÂ§©Âú∞ÂõæAPIÈÖçÁΩÆ\nconst { API_KEY: TIANDITU_API_KEY, TIMEOUT } = TIANDITU_CONFIG\n\n// ÂùêÊ†áÈ™åËØÅÂ∑•ÂÖ∑\nconst coordinateValidator = {\n    // Ê£ÄÊü•ÂùêÊ†áÊòØÂê¶Âú®ÂêàÁêÜËåÉÂõ¥ÂÜÖ\n    isValidCoordinate: (lng, lat) => {\n        return lng >= -180 && lng <= 180 && lat >= -90 && lat <= 90\n    }\n}\n\n// Â§©Âú∞ÂõæWeb APIËØ∑Ê±ÇÂáΩÊï∞\nconst requestTiandituApi = (endpoint, params) => {\n    return new Promise((resolve, reject) => {\n        const baseUrl = `https://api.tianditu.gov.cn/${endpoint}`\n\n        // ÊâãÂä®ÊûÑÂª∫Êü•ËØ¢ÂèÇÊï∞Â≠óÁ¨¶‰∏≤ÔºàÂÖºÂÆπÂ∞èÁ®ãÂ∫èÁéØÂ¢ÉÔºâ\n        const queryPairs = []\n        Object.keys(params).forEach(key => {\n            queryPairs.push(`${key}=${encodeURIComponent(params[key])}`)\n        })\n        queryPairs.push(`tk=${TIANDITU_API_KEY}`)\n\n        const fullUrl = `${baseUrl}?${queryPairs.join('&')}`\n\n        uni.request({\n            url: fullUrl,\n            method: 'GET',\n            timeout: TIMEOUT,\n            success: (res) => {\n                // Â∞èÁ®ãÂ∫èÁéØÂ¢É‰∏≠ÔºåstatusCodeÂèØËÉΩ‰∏∫undefinedÔºå‰ΩÜdataÊúâÂÄºÂ∞±ËÆ§‰∏∫ÊàêÂäü\n                if (res.data && typeof res.data === 'string' && res.data.includes('<result')) {\n                    resolve(res.data)\n                } else if (res.statusCode === 200) {\n                    resolve(res.data)\n                } else {\n                    reject(res)\n                }\n            },\n            fail: (error) => {\n                console.error('Â§©Âú∞ÂõæAPIËØ∑Ê±ÇÂ§±Ë¥•:', error)\n                reject(error)\n            }\n        })\n    })\n}\n\n// Ë∞ÉÁî®Â§©Âú∞ÂõæË∑ØÂæÑËßÑÂàíAPI\nconst callTiandituRouteAPI = async (startWgs84Coord, endWgs84Coord, midWgs84Coords = []) => {\n\n    // ÊûÑÂª∫Â§©Âú∞ÂõæË∑ØÁ∫øËßÑÂàíËØ∑Ê±ÇÂèÇÊï∞Ôºà‰ΩøÁî®WGS84ÂùêÊ†áÔºâ\n    const routeParams = {\n        orig: `${startWgs84Coord[0]},${startWgs84Coord[1]}`, // Ëµ∑ÁÇπÁªèÁ∫¨Â∫¶\n        dest: `${endWgs84Coord[0]},${endWgs84Coord[1]}`,     // ÁªàÁÇπÁªèÁ∫¨Â∫¶\n        style: '0' // 0: ÊúÄÂø´Ë∑ØÁ∫ø, 1: ÊúÄÁü≠Ë∑ØÁ∫ø, 2: ÈÅøÂºÄÈ´òÈÄü, 3: Ê≠•Ë°å\n    }\n\n    // Â¶ÇÊûúÊúâÈÄîÁªèÁÇπÔºåÊ∑ªÂä†midÂèÇÊï∞\n    if (midWgs84Coords && midWgs84Coords.length > 0) {\n        // ÈÄîÁªèÁÇπÊ†ºÂºèÔºö116.35506,39.92277;116.35506,39.92277\n        const midPointsStr = midWgs84Coords.map(coord =>\n            `${coord[0]},${coord[1]}`\n        ).join(';')\n        routeParams.mid = midPointsStr\n    }\n\n    const params = {\n        postStr: JSON.stringify(routeParams),\n        type: 'search'\n    }\n\n\n    // Ë∞ÉÁî®Â§©Âú∞ÂõæË∑ØÁ∫øËßÑÂàíAPI\n    const result = await requestTiandituApi('drive', params)\n\n    return result\n}\n\n// Ëß£ÊûêÂ§©Âú∞ÂõæËøîÂõûÁöÑXMLÊï∞ÊçÆ\nconst parseRouteXML = (xmlData) => {\n\n    try {\n        // ÊèêÂèñÂÖ≥ÈîÆ‰ø°ÊÅØÔºöË∑ùÁ¶ª„ÄÅÊó∂Èó¥„ÄÅË∑ØÁ∫øÂùêÊ†á\n\n        // ÊèêÂèñË∑ùÁ¶ª‰ø°ÊÅØ\n        const distanceMatch = xmlData.match(/<distance>([^<]+)<\\/distance>/)\n        let distance = 'Êú™Áü•'\n        if (distanceMatch) {\n            const distanceValue = parseFloat(distanceMatch[1])\n            distance = (distanceValue / 1000).toFixed(1) + 'km'\n        }\n\n        // ÊèêÂèñÊó∂Èó¥‰ø°ÊÅØ\n        const durationMatch = xmlData.match(/<duration>([^<]+)<\\/duration>/)\n        let duration = 'Êú™Áü•'\n        if (durationMatch) {\n            const durationValue = parseInt(durationMatch[1])\n            duration = Math.ceil(durationValue / 60) + 'ÂàÜÈíü'\n        }\n\n        // ÊèêÂèñË∑ØÁ∫øÂùêÊ†á\n        const routeLatLonMatch = xmlData.match(/<routelatlon>([^<]+)<\\/routelatlon>/)\n        if (routeLatLonMatch) {\n            const routeCoords = routeLatLonMatch[1]\n\n            // Ëß£ÊûêÂùêÊ†áÂ≠óÁ¨¶‰∏≤ÔºåÊ†ºÂºèÔºö116.35506,39.92277;116.35506,39.92277\n            const coordinates = routeCoords.split(';').map(coord => {\n                const [lng, lat] = coord.split(',').map(Number)\n\n                // Ê£ÄÊü•ÂùêÊ†áÊúâÊïàÊÄß\n                if (!coordinateValidator.isValidCoordinate(lng, lat)) {\n                    console.warn('Êó†ÊïàÂùêÊ†á:', coord)\n                    return null\n                }\n\n                // Â§©Âú∞ÂõæËøîÂõûÁöÑÊòØWGS84ÂùêÊ†áÔºåÈúÄË¶ÅËΩ¨Êç¢‰∏∫GCJ02ÂùêÊ†áÔºàÂú∞ÂõæÁªÑ‰ª∂‰ΩøÁî®Ôºâ\n                const gcj02Coord = gcoord.transform([lng, lat], gcoord.WGS84, gcoord.GCJ02)\n                const gcj02Lng = gcj02Coord[0]\n                const gcj02Lat = gcj02Coord[1]\n\n                return { latitude: gcj02Lat, longitude: gcj02Lng }\n            }).filter(coord => coord !== null) // ËøáÊª§ÊéâÊó†ÊïàÂùêÊ†á\n\n            if (coordinates.length > 0) {\n                // ÁªòÂà∂Ë∑ØÁ∫ø\n                drawRouteFromCoordinates(coordinates)\n\n                // ËÆ°ÁÆóÈÄîÁªèÁÇπ‰ø°ÊÅØ\n                const taskPoints = mapMarkers.value.filter(marker => marker.id !== 0)\n                const routeType = taskPoints.length === 1 ? 'Áõ¥ËææË∑ØÁ∫ø' : `ÈÄîÁªè${taskPoints.length - 1}‰∏™ÁÇπÁöÑË∑ØÁ∫ø`\n\n                // uni.showToast({\n                //     title: `${routeType}ËßÑÂàíÊàêÂäü\\nË∑ùÁ¶ª:${distance} Êó∂Èó¥:${duration}`,\n                //     icon: 'success',\n                //     duration: 3000\n                // })\n\n            } else {\n                throw new Error('ÂùêÊ†áÊï∞ÁªÑ‰∏∫Á©∫')\n            }\n        } else {\n\n            throw new Error('Êú™ÊâæÂà∞Ë∑ØÁ∫øÂùêÊ†á‰ø°ÊÅØ')\n        }\n\n    } catch (error) {\n        console.error('Ëß£ÊûêXMLÊï∞ÊçÆÂ§±Ë¥•:', error)\n    }\n}\n\n// Ê†πÊçÆÂùêÊ†áÊï∞ÁªÑÁªòÂà∂Ë∑ØÁ∫ø\nconst drawRouteFromCoordinates = (coordinates) => {\n    if (!coordinates || coordinates.length === 0) {\n        console.log('ÂùêÊ†áÊï∞ÁªÑ‰∏∫Á©∫ÔºåÊó†Ê≥ïÁªòÂà∂Ë∑ØÁ∫ø')\n        return\n    }\n\n    // Á°Æ‰øùÂùêÊ†áÊ†ºÂºèÊ≠£Á°Æ\n    const validCoordinates = coordinates.filter(coord => {\n        const isValid = typeof coord.latitude === 'number' &&\n            typeof coord.longitude === 'number' &&\n            !isNaN(coord.latitude) &&\n            !isNaN(coord.longitude)\n\n        if (!isValid) {\n            console.warn('Êó†ÊïàÂùêÊ†á:', coord)\n        }\n\n        return isValid\n    })\n\n    if (validCoordinates.length === 0) {\n        console.error('Ê≤°ÊúâÊúâÊïàÁöÑÂùêÊ†áÁÇπ')\n        return\n    }\n\n    const polyline = {\n        points: validCoordinates,\n        color: '#07c160',\n        width: 4,\n        arrowLine: true,\n        borderColor: '#ffffff',\n        borderWidth: 2\n    }\n\n    // ÂÖàÊ∏ÖÁ©∫Áé∞ÊúâË∑ØÁ∫ø\n    mapPolyline.value = []\n\n    // Âº∫Âà∂Ëß¶ÂèëÂìçÂ∫îÂºèÊõ¥Êñ∞\n    nextTick(() => {\n        mapPolyline.value = [polyline]\n        console.log('Ë∑ØÁ∫øÂ∑≤ÁªòÂà∂ÔºåÂùêÊ†áÁÇπÊï∞:', validCoordinates.length)\n    })\n}\n\n\n// onLoad: ÁÆÄÂçïÁõ¥Êé•ÁöÑÊé•Êî∂ÂèÇÊï∞ÊñπÂºè\nonLoad(() => {\n    console.log('È°µÈù¢Âä†ËΩΩÔºåÊé•Êî∂ÂèÇÊï∞')\n\n    // Áõ¥Êé•‰ªéÂ≠òÂÇ®Ëé∑ÂèñÊï∞ÊçÆÔºåÁÆÄÂçïÂèØÈù†\n    const mapData = uni.getStorageSync('mapData')\n    if (mapData) {\n        console.log('Ëé∑ÂèñÂú∞ÂõæÊï∞ÊçÆ:', mapData)\n        setMapData(mapData)\n        isDataReceived.value = true\n        // Ê∏ÖÁêÜÂ≠òÂÇ®Êï∞ÊçÆ\n        uni.removeStorageSync('mapData')\n    } else {\n        console.log('ÊöÇÊó†Êï∞ÊçÆÔºåÁ≠âÂæÖ‰º†ÈÄí')\n    }\n})\n\n// onMounted: ‰∏ìÈó®Ë¥üË¥£ÂàùÂßãÂåñÂú∞Âõæ - ‰øÆÂ§çnextTickÈóÆÈ¢ò\nonMounted(() => {\n\n\n    // Á≠âÂæÖÊï∞ÊçÆÊé•Êî∂ÂÆåÊàêÂêéÂÜçÂàùÂßãÂåñÂú∞Âõæ\n    const waitForDataAndInitMap = () => {\n        if (isDataReceived.value) {\n\n            // üî• ‰øÆÂ§çÔºöÁõ¥Êé•‰ΩøÁî®setTimeoutÔºå‰∏çÁî®nextTick\n            setTimeout(() => {\n                // ÂºÄÂßãÊåÅÁª≠ÂÆö‰Ωç\n                startContinuousLocation()\n            }, 500) // ÂáèÂ∞ëÂª∂ËøüÊó∂Èó¥\n        } else {\n            // Êï∞ÊçÆËøòÊ≤°Êé•Êî∂ÂÆåÊàêÔºåÁªßÁª≠Á≠âÂæÖ\n            setTimeout(waitForDataAndInitMap, 100)\n        }\n    }\n\n    // ÂºÄÂßãÁ≠âÂæÖÊï∞ÊçÆ\n    waitForDataAndInitMap()\n})\n\n// È°µÈù¢Âç∏ËΩΩÊó∂Ê∏ÖÁêÜÂÆöÊó∂Âô®\nonUnmounted(() => {\n    stopContinuousLocation()\n})\n\n// ËÆæÁΩÆÂú∞ÂõæÊï∞ÊçÆÁöÑÈÄöÁî®ÊñπÊ≥ï\nconst setMapData = (data) => {\n    // Á≠õÈÄâÂá∫status == 0ÁöÑ‰ªªÂä°Êï∞ÊçÆ\n    const filteredTaskList = (data.taskList || []).filter(task => task.status == 0)\n    taskList.value = filteredTaskList\n    driverName.value = data.driverName || ''\n    registrationNumber.value = data.registrationNumber || ''\n    bucketNum.value = data.bucketNum || 0\n    currentDate.value = data.currentDate || ''\n\n}\n\n// ËøîÂõû‰∏ä‰∏ÄÈ°µ\nconst back = () => {\n    // ÂÅúÊ≠¢ÊåÅÁª≠ÂÆö‰Ωç\n    stopContinuousLocation()\n    uni.navigateBack()\n}\n\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n    background-color: $bg-theme-color;\n    min-height: 100vh;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: column;\n\n\n    .map-container {\n        height: 1000rpx; // ÁªôÂú∞ÂõæÂõ∫ÂÆöÈ´òÂ∫¶\n        position: relative;\n\n        .navigation-map {\n            width: 100%;\n            height: 100%;\n        }\n\n        .location-status {\n            position: absolute;\n            top: 30rpx;\n            left: 50%;\n            transform: translateX(-50%);\n            background-color: rgba(255, 255, 255, 0.95);\n            border-radius: 50rpx;\n            padding: 20rpx 30rpx;\n            display: flex;\n            align-items: center;\n            gap: 15rpx;\n            box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.15);\n            z-index: 999;\n            border: 2rpx solid #07C160;\n\n            .status-text {\n                color: #07C160;\n                font-size: 28rpx;\n                font-weight: 500;\n            }\n        }\n\n    }\n\n    .bottom-section {\n        padding: 30rpx;\n        background-color: $bg-theme-color;\n\n        .driver-info-card {\n            background: #FFFFFF;\n            border-radius: 16rpx;\n            padding: 30rpx;\n            margin-bottom: 20rpx;\n\n            .info-item {\n                display: flex;\n                align-items: center;\n                gap: 20rpx;\n                margin-bottom: 20rpx;\n\n                .avatar {\n                    width: 60rpx;\n                    height: 60rpx;\n                    border-radius: 50%;\n                    background-color: #07C160;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n\n                    .avatar-text {\n                        color: white;\n                        font-size: 24rpx;\n                        font-weight: 500;\n                    }\n                }\n\n                .name-info {\n                    flex: 1;\n                    display: flex;\n                    align-items: center;\n                    gap: 10rpx;\n\n                    .label {\n                        color: rgba(61, 61, 61, 0.50);\n                        font-size: 28rpx;\n                    }\n\n                    .value {\n                        color: rgba(61, 61, 61, 1);\n                        font-size: 28rpx;\n                        font-weight: 500;\n                    }\n                }\n            }\n\n            .divider {\n                height: 2rpx;\n                background-color: #f0f0f0;\n                margin: 20rpx 0;\n            }\n\n            .driver-details {\n                display: flex;\n                flex-direction: column;\n                gap: 20rpx;\n\n                .detail-item {\n                    display: flex;\n                    align-items: center;\n\n                    .label {\n                        color: rgba(61, 61, 61, 0.50);\n                        font-size: 28rpx;\n                        min-width: 180rpx;\n                    }\n\n                    .value {\n                        color: rgba(61, 61, 61, 1);\n                        font-size: 28rpx;\n                    }\n                }\n            }\n        }\n\n    }\n}\n\n\nbody {\n    background-color: #F5F5F5;\n}\n</style>\n","import MiniProgramPage from '/Users/yx/Documents/Vue3Projects/cycl/pages/collection/syAllMap.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","computed","uni","gcoord","TIANDITU_CONFIG","nextTick","onLoad","onMounted","onUnmounted"],"mappings":"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"}