{"version":3,"file":"sfDetails.js","sources":["pages/collection/sfDetails.vue","pages/collection/sfDetails.vue?type=page"],"sourcesContent":["<!-- 收运详情 -->\n<template>\n    <view class=\"container\">\n        <view class=\"headImage\">\n            <image src=\"/static/headTopBg.png\" mode=\"aspectFill\"></image>\n        </view>\n        <uni-nav-bar dark :fixed=\"true\" :background-color=\"navBarBgColor\" status-bar left-icon=\"left\" color=\"#000\"\n            title=\"今日收运详情\" @clickLeft=\"back\" />\n        <view class=\"header-progress-container\">\n            <view class=\"header\">\n                <view class=\"driver-info\">\n                    <view class=\"info-item\">\n                        <uni-text class=\"label\">司机名称：</uni-text>\n                        <uni-text class=\"value\">{{ name }}</uni-text>\n                    </view>\n                    <view class=\"info-item\">\n                        <uni-text class=\"label\">车牌号：</uni-text>\n                        <uni-text class=\"value\">{{ registrationNumber }}</uni-text>\n                    </view>\n                    <view class=\"info-item\">\n                        <uni-text class=\"label\">日期：</uni-text>\n                        <uni-text class=\"value\">{{ currentDate }}</uni-text>\n                    </view>\n                    <view class=\"info-item\">\n                        <uni-text class=\"label\">垃圾桶数：</uni-text>\n                        <uni-text class=\"value\">{{ bucketNum }}个</uni-text>\n                    </view>\n                </view>\n            </view>\n            <view class=\"divider\"></view>\n            <view class=\"progress-section\">\n                <view class=\"progress-title\">收运完成率</view>\n                <view class=\"progress-content\">\n                    <view class=\"progress-bar\">\n                        <view class=\"progress-fill\" :style=\"{ width: progressPercentage + '%' }\">\n                            <view class=\"progress-bubble\">\n                                <image src=\"/static/ssd/bubble.png\" mode=\"aspectFill\"></image>\n                                <view class=\"bubble-text\">{{ progressPercentage }}%</view>\n                            </view>\n                        </view>\n                    </view>\n                    <view class=\"progress-stats\">\n                        <view class=\"stat-item\">\n                            <view class=\"label-with-color\">\n                                <view class=\"color-tag blue\"></view>\n                                <uni-text class=\"label\">总重量</uni-text>\n                            </view>\n                            <uni-text class=\"value\">{{ weightNum }} kg</uni-text>\n                        </view>\n                        <view class=\"stat-item\">\n                            <view class=\"label-with-color\">\n                                <view class=\"color-tag green\"></view>\n                                <uni-text class=\"label\">已收运商家</uni-text>\n                            </view>\n                            <uni-text class=\"value\">{{ confirmNum }} 个</uni-text>\n\n                        </view>\n                        <view class=\"stat-item\">\n                            <view class=\"label-with-color\">\n                                <view class=\"color-tag orange\"></view>\n                                <uni-text class=\"label\">未收运商家</uni-text>\n                            </view>\n                            <uni-text class=\"value\">{{ notConfirmNum }} 个</uni-text>\n                        </view>\n                    </view>\n                </view>\n            </view>\n        </view>\n        <view class=\"weight-section\">\n            <uni-text class=\"weight-header\">过磅信息 </uni-text>\n            <view class=\"weight-content\">\n                <image src=\"/static/ssd/gbicon.png\" mode=\"aspectFill\"></image>\n                <uni-text class=\"weight-title\">重量：</uni-text>\n                <input class=\"weight-input\" type=\"number\" v-model=\"weightInput\" placeholder=\"0\" disabled />\n                <uni-text class=\"weight-unit\">kg</uni-text>\n                <uni-button size=\"mini\" type=\"primary\" class=\"tj-btn\" @tap=\"handleSubmitWeight()\">获取重量</uni-button>\n            </view>\n        </view>\n\n        <view class=\"abnormal-section\" v-if=\"abnormalList.length > 0\">\n            <view class=\"abnormal-item\">\n                <image src=\"/static/ssd/warning.png\" mode=\"aspectFill\"></image>\n                <uni-text class=\"abnormal-label\">异常:</uni-text>\n                <swiper class=\"abnormal-swiper\" :autoplay=\"abnormalList.length > 1\" :interval=\"3000\" :duration=\"500\"\n                    :circular=\"true\" :vertical=\"true\" :indicator-dots=\"false\" :display-multiple-items=\"1\"\n                    :touchable=\"false\" :disable-touch=\"true\">\n                    <swiper-item v-for=\"(item, index) in abnormalList\" :key=\"index\">\n                        <view class=\"abnormal-text-wrapper\">\n                            <uni-text class=\"abnormal-text\">{{ item.merchantName }}连续 {{ item.notCollectNum }}\n                                次未收运</uni-text>\n                        </view>\n                    </swiper-item>\n                </swiper>\n            </view>\n        </view>\n\n        <view class=\"collection-info-section\">\n            <view class=\"collection-info\">\n                <uni-text class=\"info-title\">收运信息</uni-text>\n                <uni-button size=\"mini\" type=\"primary\" class=\"contact-btn\" @tap=\"contactLine()\">查看线路</uni-button>\n            </view>\n            <view class=\"map-container\">\n                <map class=\"location-map\" :longitude=\"currentLocation.longitude\" :latitude=\"currentLocation.latitude\"\n                    :markers=\"markers\" :show-location=\"true\" :enable-zoom=\"true\" :enable-scroll=\"true\">\n                </map>\n            </view>\n        </view>\n\n        <view class=\"task-list\">\n            <view class=\"task-item\" v-for=\"(task, index) in taskList\" :key=\"task.id\" :style=\"{\n                '--line-top-height': getLinePositions(index).topHeight + 'rpx',\n                '--line-bottom-top': getLinePositions(index).bottomTop + 'rpx'\n            }\">\n                <view class=\"task-header\">\n                    <view class=\"time-info\">\n                        <view class=\"icon-container\">\n                            <uni-icons type=\"circle-filled\"\n                                :color=\"index === 0 ? 'rgba(7, 193, 96, 1)' : 'rgba(61, 61, 61, 0.50)'\"\n                                :size=\"index === 0 ? ICON_SIZE.first : ICON_SIZE.normal\">\n                            </uni-icons>\n                        </view>\n                        <uni-text class=\"date\">{{ task.appointmentTime }}</uni-text>\n                    </view>\n                    <DriverStatusTag :status=\"task.status\" />\n                </view>\n                <view class=\"divider\"></view>\n                <view class=\"task-content\">\n                    <InfoDisplay :fields=\"getInfoFields(task)\" :show-bottom-border=\"false\" :showTopBorder=\"false\"\n                        :enable-address-navigation=\"true\" />\n                </view>\n                <DriverOrderActions :status=\"task.status\" :order-data=\"task\" @refresh=\"handleRefresh\"\n                    @abnormalReport=\"handleAbnormalReport\" />\n            </view>\n        </view>\n        <view class=\"headImage\">\n            <image src=\"/static/headTopBg.png\" mode=\"aspectFill\"></image>\n        </view>\n\n        <!-- 异常上报弹窗 -->\n        <AbnormalReportModal :show=\"showAbnormalModal\" :order-data=\"currentOrderData\" @close=\"closeAbnormalModal\"\n            @success=\"handleAbnormalSuccess\" />\n    </view>\n\n</template>\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { onShow, onPageScroll } from '@dcloudio/uni-app' // 导入onShow和onPageScroll生命周期\nimport { useUserStore } from '@/stores/user.js'\nimport { apiGetDriverInfo, apiGetDriverTodayPlan, apiGetnoNeedCollect, apiGetCarWeight, apiGetAbnormalPlan } from '@/api/apis.js'\nimport DriverStatusTag from '@/components/DriverStatusTag/DriverStatusTag.vue'\nimport DriverOrderActions from '@/components/DriverOrderActions/DriverOrderActions.vue'\nimport InfoDisplay from '@/components/InfoDisplay/InfoDisplay.vue'\nimport AbnormalReportModal from '@/components/AbnormalReportModal/AbnormalReportModal.vue'\nimport { formatWeight, formatNum } from '@/utils/orderUtils'\n\n// 获取当前日期并格式化为 YYYY-MM-DD 格式\nconst getCurrentDate = () => {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n};\n\nconst userStore = useUserStore()\nconst weightNum = ref(0) // 已收运总量\nconst notConfirmNum = ref(0) // 未收运\nconst confirmNum = ref(0) // 已收运\nconst bucketNum = ref(0) // 垃圾桶数\nconst registrationNumber = ref('') // 车牌号\nconst name = ref('') // 司机名称\nconst currentDate = getCurrentDate() // 当前日期\nconst weightInput = ref('') // 重量输入框的值\nconst allCarId = ref(0)//车辆Id\nconst allRecordNo = ref('')//运单号\nconst navBarBgColor = ref('transparent') // 导航栏背景色\n\nconst taskList = ref([]) // 任务列表\nconst abnormalList = ref([]) // 异常列表\n\n// 地图相关数据\nconst currentLocation = ref({\n    longitude: 104.066, // 默认经度\n    latitude: 30.5728   // 默认纬度\n})\nconst markers = ref([]) // 地图标记点\n\n// 图标大小配置\nconst ICON_SIZE = {\n    first: 25,  // 第一个图标大小\n    normal: 20  // 普通图标大小\n}\n\n// 计算连接线位置\nconst getLinePositions = (index) => {\n    const iconSize = index === 0 ? ICON_SIZE.first : ICON_SIZE.normal\n    const containerHeight = 50 // 容器高度\n    const containerCenter = containerHeight / 2 // 容器中心位置 25rpx\n    const iconRadius = iconSize / 2\n\n    // 分析布局结构：\n    // task-item (padding: 30rpx)\n    //   └── task-header (margin-bottom: 20rpx)\n    //       └── time-info (align-items: center)\n    //           └── icon-container (50rpx × 50rpx, margin-left: -5rpx)\n    //               └── 图标 (居中)\n\n    // 从task-item顶部到图标顶部的距离：\n    const taskItemPadding = 30 // task-item的padding\n    const taskHeaderMarginBottom = 20 // task-header的margin-bottom\n    const timeInfoHeight = 50 // time-info的高度（与icon-container相同）\n    const timeInfoTop = (timeInfoHeight - containerHeight) / 2 // time-info在task-header中的垂直居中位置\n    const topToIconTop = taskItemPadding + timeInfoTop + containerCenter - iconRadius\n\n    return {\n        topHeight: topToIconTop, // 上半段高度：从task-item顶部到图标顶部\n        bottomTop: topToIconTop + iconSize  // 下半段起始位置：从task-item顶部到图标底部\n    }\n}\n\n// 获取当前定位\nconst getCurrentLocation = () => {\n    uni.getLocation({\n        type: 'gcj02',\n        success: (res) => {\n            currentLocation.value = {\n                longitude: res.longitude,\n                latitude: res.latitude\n            }\n            // 设置当前位置标记\n            markers.value = [{\n                id: 1,\n                longitude: res.longitude,\n                latitude: res.latitude,\n                title: '当前位置',\n                iconPath: '/static/ssd/positioning.png',\n                width: 30,\n                height: 30\n            }]\n            console.log('获取定位成功:', res)\n        },\n        fail: (err) => {\n            console.error('获取定位失败:', err)\n            uni.showToast({\n                title: '获取定位失败',\n                icon: 'none'\n            })\n        }\n    })\n}\n\n// 计算进度百分比\nconst progressPercentage = computed(() => {\n\n    if (confirmNum.value === 0 && weightNum.value === 0) return 0;\n    return Math.round((confirmNum.value / (confirmNum.value + notConfirmNum.value)) * 100);\n});\n\n\n// 统一调用所有接口的函数\nconst loadAllData = async () => {\n    getCurrentLocation(); // 获取当前定位\n    try {\n        // 需要调用的接口列表（方便修改查看）\n        await Promise.all([\n            getapiGetDriverInfo(),\n            getapiGetDriverTodayPlan(),\n            getapiGetAbnormalPlan()\n        ]);\n    } catch (error) {\n        console.error('加载数据失败:', error);\n    }\n};\n\nonMounted(async () => {\n    // 页面加载时的逻辑\n    try {\n        // const userInfo = await userStore.ensureUserInfo()\n        // if (userInfo === null) {\n        //     // 用户未登录，已跳转到登录页，不需要继续执行\n        //     console.log('用户未登录，已跳转到登录页')\n        //     return\n        // }\n        // await loadAllData();\n\n    } catch (error) {\n        // 其他非401错误的处理\n        console.error('页面初始化失败:', error)\n    }\n})\n\n// 根据状态获取信息字段\nconst getInfoFields = (task) => {\n    const status = task.status;\n\n    // 状态为 0（进行中）或 2（无法收运）时显示预估信息\n    if (status === 0 || status === '0' || status === 2 || status === '2') {\n        return [\n            {\n                key: 'merchantName',\n                label: '商户名称',\n                value: task.merchantName\n            },\n            {\n                key: 'estimateWeight',\n                label: '预估重量',\n                value: formatWeight(task.estimateWeight)\n            },\n            {\n                key: 'estimateBucketNum',\n                label: '预估桶数',\n                value: formatNum(task.estimateBucketNum)\n            },\n            {\n                key: 'address',\n                label: '地址',\n                value: task.address,\n                taskData: task // 传递完整的任务数据，包含经纬度信息\n            }\n        ];\n    }\n\n    // 状态为 1（已完成）时显示收运信息\n    if (status === 1 || status === '1') {\n        return [\n            {\n                key: 'merchantName',\n                label: '商户名称',\n                value: task.merchantName\n            },\n            {\n                key: 'weight',\n                label: '收运重量',\n                value: formatWeight(task.weight)\n            },\n            {\n                key: 'bucketNum',\n                label: '收运桶数',\n                value: formatNum(task.bucketNum)\n            },\n            {\n                key: 'address',\n                label: '地址',\n                value: task.address,\n                taskData: task // 传递完整的任务数据，包含经纬度信息\n            }\n        ];\n    }\n\n    // 默认返回预估信息\n    return [\n        {\n            key: 'merchantName',\n            label: '商户名称',\n            value: task.merchantName\n        },\n        {\n            key: 'estimateWeight',\n            label: '预估重量',\n            value: formatWeight(task.estimateWeight)\n        },\n        {\n            key: 'estimateBucketNum',\n            label: '预估桶数',\n            value: formatNum(task.estimateBucketNum)\n        },\n        {\n            key: 'address',\n            label: '地址',\n            value: task.address\n        }\n    ];\n};\n\n// 页面显示时刷新数据\nonShow(async () => {\n    console.log('页面显示时刷新数据')\n    await loadAllData();\n    getCurrentLocation(); // 获取当前定位\n})\n\n// 处理异常上报后的刷新\nconst handleRefresh = async () => {\n    try {\n        // 重新加载所有数据\n        await loadAllData();\n    } catch (error) {\n        console.error('刷新数据失败:', error)\n    }\n}\n\n// 异常上报相关变量\nconst showAbnormalModal = ref(false)\nconst currentOrderData = ref(null)\n\n// 处理异常上报事件\nconst handleAbnormalReport = (orderData) => {\n    console.log('异常上报事件', orderData)\n    currentOrderData.value = orderData\n    showAbnormalModal.value = true\n}\n\n// 关闭异常上报弹窗\nconst closeAbnormalModal = () => {\n    showAbnormalModal.value = false\n    currentOrderData.value = null\n}\n\n// 异常上报成功回调\nconst handleAbnormalSuccess = async () => {\n    // 刷新数据\n    await handleRefresh()\n}\n\n// 任务操作逻辑已完全封装到 DriverOrderActions 组件中\n\n// 注册页面滚动监听\nonPageScroll((e) => {\n    const scrollTop = e.scrollTop;\n    // 当滚动超过背景图片高度时，显示白色背景\n    if (scrollTop > 20) {\n        navBarBgColor.value = '#fff';\n    } else {\n        navBarBgColor.value = 'transparent';\n    }\n})\n\n\n//获取今日统计信息\nconst getapiGetDriverInfo = async () => {\n    try {\n        const res = await apiGetDriverInfo({\n            driverId: userStore.sfmerchant?.id,\n        })\n\n        if (res.code === 200) {\n            if (res.data === null)\n                return;\n            confirmNum.value = res.data.confirmNum ?? 0;\n            notConfirmNum.value = res.data.notConfirmNum ?? 0;\n            weightNum.value = res.data.weightNum ?? 0;\n\n            bucketNum.value = res.data.bucketNum ?? 0;\n            registrationNumber.value = res.data.registrationNumber;\n            name.value = res.data.name;\n            allCarId.value = res.data.carId;\n            allRecordNo.value = res.data.crecordNo;\n        } else {\n            console.error('获取司机信息失败:', res.message || '未知错误');\n        }\n    } catch (error) {\n        console.error('获取司机信息异常:', error);\n    }\n}\n\n//司机今日收运管理列表\nconst getapiGetDriverTodayPlan = async () => {\n    try {\n        const res = await apiGetDriverTodayPlan({\n            driverId: userStore.sfmerchant?.id,\n            page: 1,\n        })\n        // status  0进行中  1已完成  2无需收运\n        if (res.code === 200) {\n            taskList.value = res.data;\n        } else {\n            console.error('获取今日收运计划失败:', res.message || '未知错误');\n        }\n    } catch (error) {\n        console.error('获取今日收运计划异常:', error);\n    }\n}\n\n//获取异常计划列表\nconst getapiGetAbnormalPlan = async () => {\n    try {\n        const res = await apiGetAbnormalPlan({\n            driverId: userStore.sfmerchant?.id,\n        })\n        if (res.code === 200) {\n            abnormalList.value = res.data || [];\n        } else {\n            console.error('获取异常计划失败:', res.message || '未知错误');\n            abnormalList.value = [];\n        }\n    } catch (error) {\n        console.error('获取异常计划异常:', error);\n        abnormalList.value = [];\n    }\n}\n\n\n\n\n// 原来的方法已封装到 DriverOrderActions 组件中\n\n\n\nconst contactLine = () => {\n    console.log('查看线路');\n\n    const mapData = {\n        taskList: taskList.value,\n        driverName: name.value,\n        registrationNumber: registrationNumber.value,\n        bucketNum: bucketNum.value,\n        currentDate: currentDate\n    };\n\n    // 简单直接：先存储数据再跳转\n    uni.setStorageSync('mapData', mapData);\n    console.log('数据已存储，跳转页面');\n\n    uni.navigateTo({\n        url: '/pages/collection/syAllMap'\n    });\n};\n\n// 获取重量\nconst handleSubmitWeight = async () => {\n    uni.showModal({\n        title: '注意!',\n        content: '需要车辆过磅后才能获取重量!',\n        showCancel: true,\n        cancelText: '取消',\n        confirmText: '确定',\n        success: async (res) => {\n            if (res.confirm) {\n                try {\n                    const result = await apiGetCarWeight({\n                        driverId: userStore.sfmerchant?.id\n                    });\n\n                    if (result.code === 200) {\n                        if (result.data && result.data.weight) {\n                            weightInput.value = result.data.weight;\n                            uni.showToast({\n                                title: '获取重量成功',\n                                icon: 'success'\n                            });\n                        } else {\n                            uni.showToast({\n                                title: '暂无过磅重量数据',\n                                icon: 'none'\n                            });\n                        }\n                    } else {\n                        uni.showToast({\n                            title: result.message || '获取重量失败',\n                            icon: 'none'\n                        });\n                    }\n                } catch (error) {\n                    uni.showToast({\n                        title: '获取重量失败，请确保车辆已过磅',\n                        icon: 'none'\n                    });\n                    console.error('获取重量失败:', error);\n                }\n            }\n        }\n    });\n};\n\n// 返回上一页\nconst back = () => {\n    uni.navigateBack();\n};\n\n\n// 组件逻辑\n</script>\n\n\n\n<style scoped lang=\"scss\">\n.container {\n    background-color: $bg-theme-color;\n    min-height: 100vh;\n    box-sizing: border-box;\n    padding: 0 30rpx 30rpx;\n    position: relative;\n\n    .header-progress-container {\n        background: #FFFFFF;\n        border-radius: 20rpx;\n        padding: 30rpx;\n        margin-bottom: 20rpx;\n        margin-top: 20rpx;\n        position: relative;\n        z-index: 1;\n    }\n\n    .header {\n        background: none;\n        border-radius: 0;\n        padding: 0;\n        margin-bottom: 0;\n\n        .header-title {\n            margin-bottom: 20rpx;\n\n            .title {\n                font-size: 16px;\n                font-weight: 500;\n                color: #333333;\n            }\n        }\n\n        .driver-info {\n            display: flex;\n            flex-direction: column;\n            gap: 10rpx;\n\n            .info-item {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n\n                .label {\n                    color: rgba(61, 61, 61, 0.50);\n                    font-size: 28rpx;\n                }\n\n                .value {\n                    color: rgba(61, 61, 61, 1);\n                    font-size: 28rpx;\n                }\n\n            }\n        }\n    }\n\n    .divider {\n        height: 2rpx;\n        background-color: #f0f0f0;\n        margin: 20rpx 0;\n    }\n\n    .progress-section {\n        background: none;\n        border-radius: 0;\n        padding: 0;\n        margin-bottom: 0;\n\n\n        .progress-title {\n            font-size: 28rpx;\n            color: rgba(61, 61, 61, 1);\n\n        }\n\n        .progress-content {\n            display: flex;\n            align-items: center;\n            flex-direction: column;\n            margin-top: 66rpx;\n\n\n            .progress-bar {\n                width: 650rpx;\n                height: 20rpx;\n                background-color: rgba(7, 193, 96, 0.10);\n                border-radius: 20rpx;\n                overflow: visible;\n                position: relative;\n                margin-bottom: 40rpx;\n\n                .progress-fill {\n                    height: 100%;\n                    background-color: #07C160;\n                    border-radius: 20rpx;\n                    transition: width 0.3s ease;\n                    position: relative;\n\n                    .progress-bubble {\n                        position: absolute;\n                        right: -32rpx;\n                        top: -60rpx;\n                        width: 68rpx;\n                        height: 50rpx;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n\n                        image {\n                            width: 100%;\n                            height: 100%;\n                            position: absolute;\n                            top: 0;\n                            left: 0;\n                        }\n\n                        .bubble-text {\n                            font-size: 24rpx;\n                            color: rgba(7, 193, 96, 1);\n                            font-weight: bold;\n                            z-index: 1;\n                            position: relative;\n                            transform: translateY(-10rpx);\n                        }\n                    }\n                }\n            }\n\n            .progress-text {\n                text-align: center;\n\n                .percentage {\n                    font-size: 48rpx;\n                    color: #07C160;\n                    font-weight: 400;\n                    display: block;\n                }\n\n                .label {\n                    font-size: 24rpx;\n                    color: rgba(61, 61, 61, 0.50);\n                }\n            }\n\n\n            .progress-stats {\n                flex: 1;\n                display: flex;\n                gap: 20rpx;\n\n                .stat-item {\n                    width: 204rpx;\n                    height: 108rpx;\n                    display: flex;\n                    flex-direction: column;\n                    justify-content: center;\n                    align-items: center;\n                    position: relative;\n                    background: rgba(245, 245, 247, 1);\n\n                    .label-with-color {\n                        display: flex;\n                        align-items: center;\n                        gap: 10rpx;\n\n                        .color-tag {\n                            width: 4rpx;\n                            height: 20rpx;\n                            border-radius: 2rpx;\n\n                            &.blue {\n                                background-color: rgba(0, 170, 255, 1);\n                            }\n\n                            &.green {\n                                background-color: rgba(7, 193, 96, 1);\n                            }\n\n                            &.orange {\n                                background-color: rgba(255, 161, 0, 1);\n                            }\n                        }\n\n                        .label {\n                            font-size: 24rpx;\n                            color: rgba(61, 61, 61, 0.50);\n                            z-index: 1;\n                            text-align: center;\n                        }\n                    }\n\n                    .value {\n                        font-size: 32rpx;\n                        font-weight: bold;\n                        display: block;\n                        z-index: 1;\n                        text-align: center;\n\n                    }\n\n\n                }\n            }\n        }\n    }\n\n    .weight-section {\n        background: #FFFFFF;\n        border-radius: 20rpx;\n        padding: 30rpx;\n        margin-bottom: 10rpx;\n        position: relative;\n        z-index: 1;\n\n        .weight-header {\n            font-size: 28rpx;\n            color: rgba(61, 61, 61, 1);\n            display: block;\n            margin-bottom: 20rpx;\n        }\n\n        .weight-content {\n            display: flex;\n            align-items: center;\n\n            image {\n                width: 80rpx;\n                height: 80rpx;\n                margin-right: 40rpx;\n            }\n\n            .weight-title {\n                font-size: 14px;\n                color: #333333;\n            }\n\n            .weight-input {\n                margin: 0 10rpx;\n                padding: 10rpx 20rpx;\n                border: 1rpx solid #ddd;\n                border-radius: 10rpx;\n                font-size: 14px;\n                width: 120rpx;\n                text-align: center;\n            }\n\n            .weight-unit {\n                font-size: 28rpx;\n                color: #999999;\n                margin-left: 10rpx;\n            }\n\n            .weight-btn {\n                margin-left: auto;\n                background-color: #00B578;\n            }\n        }\n\n\n        .tj-btn {\n            margin-left: auto;\n            color: #07C160;\n            border-radius: 100rpx;\n            padding: 6rpx 20rpx;\n            border: 2rpx solid #07C160;\n            font-size: 26rpx;\n        }\n    }\n\n    .abnormal-section {\n        background: #FFFFFF;\n        border-radius: 16rpx;\n        margin: 20rpx 0;\n        position: relative;\n        z-index: 1;\n        height: 60rpx;\n        overflow: hidden;\n        /* 禁用交互 */\n        pointer-events: none;\n        user-select: none;\n\n        .abnormal-item {\n            display: flex;\n            align-items: center;\n            gap: 10rpx;\n            height: 60rpx;\n            padding: 0 20rpx;\n\n            image {\n                width: 32rpx;\n                height: 32rpx;\n            }\n\n            .abnormal-label {\n                font-size: 26rpx;\n                color: rgba(61, 61, 61, 1);\n                flex-shrink: 0;\n            }\n\n            .abnormal-swiper {\n                flex: 1;\n                height: 100%;\n\n                .abnormal-text-wrapper {\n                    height: 100%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: flex-start;\n                }\n\n                .abnormal-text {\n                    font-size: 26rpx;\n                    color: rgba(61, 61, 61, 1);\n                    line-height: 1.2;\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                }\n            }\n        }\n    }\n\n    .collection-info-section {\n        background: #FFFFFF;\n        border-radius: 20rpx 20rpx 0 0;\n        padding: 30rpx;\n        margin-top: 20rpx;\n        border-bottom: 1rpx solid rgba(216, 216, 216, 0.5);\n\n        .collection-info {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 20rpx;\n\n            .info-title {\n                font-size: 28rpx;\n                color: rgba(61, 61, 61, 1);\n                font-weight: 500;\n            }\n\n            .contact-btn {\n                color: #07C160;\n                border-radius: 100rpx;\n                padding: 6rpx 20rpx;\n                border: 2rpx solid #07C160;\n                font-size: 26rpx;\n            }\n        }\n\n        .map-container {\n            width: 645rpx;\n            height: 368rpx;\n            border-radius: 20rpx;\n            overflow: hidden;\n\n            .location-map {\n                width: 100%;\n                height: 100%;\n            }\n        }\n    }\n\n    .task-list {\n        margin-top: 0;\n        position: relative;\n        z-index: 1;\n        background: #FFFFFF;\n        border-radius: 0 0 20rpx 20rpx;\n        overflow: hidden;\n        /* 移除左右内边距，因为任务项本身已经有30rpx的padding */\n\n        /* 移除整体时间轴线，改用分段方式 */\n\n        .task-item {\n            background: #FFFFFF;\n            border-radius: 0;\n            padding: 30rpx;\n            margin-top: 0;\n\n            margin-bottom: 0;\n            /* 移除任务项之间的间隔，让图标可以连线 */\n            position: relative;\n            z-index: 1;\n\n            /* 为除了第一个task-item添加上半段线条（从item顶部到uni-icons顶部） */\n            &:not(:first-child)::before {\n                content: '';\n                position: absolute;\n                left: 50rpx;\n                /* 图标容器中心位置 */\n                top: 0;\n                width: 2rpx;\n                height: var(--line-top-height, 15rpx);\n                /* 预计算的高度：容器中心(25rpx) - 图标半径 */\n                background-color: rgba(216, 216, 216, 0.8);\n                z-index: 1;\n            }\n\n            /* 为除了最后一个task-item添加下半段线条（从uni-icons底部到item底部） */\n            &:not(:last-child)::after {\n                content: '';\n                position: absolute;\n                left: 50rpx;\n                /* 图标容器中心位置 */\n                top: var(--line-bottom-top, 35rpx);\n                width: 2rpx;\n                height: calc(100% - var(--line-bottom-top, 35rpx));\n                /* 预计算：从图标底部到item底部 */\n                background-color: rgba(216, 216, 216, 0.8);\n                z-index: 1;\n            }\n\n            .task-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 20rpx;\n\n                .time-info {\n                    display: flex;\n                    align-items: center;\n                    gap: 25rpx;\n                    /* 确保icon与时间文本之间有25rpx间距 */\n                    position: relative;\n                    z-index: 10;\n                    /* 设置高层级，确保图标在时间线之上 */\n\n                    .icon-container {\n                        width: 50rpx;\n                        height: 50rpx;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        position: relative;\n                        margin-left: -5rpx;\n                    }\n\n\n                    .date {\n                        font-size: 28rpx;\n                        color: #666666;\n                    }\n                }\n\n            }\n\n            .divider {\n                height: 2rpx;\n                background-color: #f0f0f0;\n                margin: 22rpx 22rpx 0 55rpx;\n            }\n\n            .task-content {\n                margin: 22rpx 22rpx 0 55rpx;\n            }\n\n        }\n    }\n\n    .headImage {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 442rpx;\n        z-index: 0;\n        overflow: hidden;\n\n        image {\n            width: 100%;\n            height: 100%;\n            object-fit: cover;\n        }\n    }\n}\n\n/* 确保页面背景色始终正确显示 */\npage {\n    background-color: #F5F5F5;\n    height: 100%;\n}\n\nbody {\n    background-color: #F5F5F5;\n}\n</style>","import MiniProgramPage from '/Users/yx/Documents/Vue3Projects/cycl/pages/collection/sfDetails.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","uni","computed","onMounted","formatWeight","formatNum","onShow","onPageScroll","apiGetDriverInfo","apiGetDriverTodayPlan","apiGetAbnormalPlan","apiGetCarWeight"],"mappings":"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"}