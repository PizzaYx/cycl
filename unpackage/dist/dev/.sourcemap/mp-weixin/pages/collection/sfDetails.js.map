{"version":3,"file":"sfDetails.js","sources":["pages/collection/sfDetails.vue","pages/collection/sfDetails.vue?type=page"],"sourcesContent":["<!-- 收运详情 -->\n<template>\n    <view class=\"container\">\n        <uni-nav-bar dark :fixed=\"true\" background-color=\"#fff\" status-bar left-icon=\"left\" color=\"#000\" title=\"收运详情\"\n            @clickLeft=\"back\" />\n        <view class=\"header-progress-container\">\n            <view class=\"header\">\n                <view class=\"driver-info\">\n                    <view class=\"info-item\">\n                        <uni-text class=\"label\">司机名称：</uni-text>\n                        <uni-text class=\"value\">{{ name }}</uni-text>\n                        <uni-button size=\"mini\" type=\"primary\" class=\"contact-btn\">查看线路</uni-button>\n                    </view>\n                    <view class=\"info-item\">\n                        <uni-text class=\"label\">车牌号：</uni-text>\n                        <uni-text class=\"value\">{{ registrationNumber }}</uni-text>\n                    </view>\n                    <view class=\"info-item\">\n                        <uni-text class=\"label\">日期：</uni-text>\n                        <uni-text class=\"value\">{{ currentDate }}</uni-text>\n                    </view>\n                    <view class=\"info-item\">\n                        <uni-text class=\"label\">垃圾桶数：</uni-text>\n                        <uni-text class=\"value\">{{ bucketNum }}个</uni-text>\n                    </view>\n                </view>\n            </view>\n            <view class=\"divider\"></view>\n            <view class=\"progress-section\">\n                <view class=\"progress-title\">收运完成率</view>\n                <view class=\"progress-content\">\n                    <view class=\"progress-circle\"\n                        :style=\"{ background: `conic-gradient(#07C160 ${progressPercentage}%, rgba(216, 216, 216, 0.5) ${progressPercentage}% 100%)` }\">\n                        <view class=\"circle-text\">\n                            <uni-text class=\"percentage\">{{ progressPercentage }}%</uni-text>\n                            <uni-text class=\"label\">已完成</uni-text>\n                        </view>\n                    </view>\n                    <view class=\"progress-stats\">\n                        <view class=\"stat-item\">\n                            <image src=\"/static/ssd/greenbg.png\" mode=\"aspectFill\"></image>\n                            <uni-text class=\"value green\">{{ confirmNum }}</uni-text>\n                            <uni-text class=\"label\">已收运</uni-text>\n                        </view>\n                        <view class=\"stat-item\">\n                            <image src=\"/static/ssd/orangebg.png\" mode=\"aspectFill\"></image>\n                            <uni-text class=\"value orange\">{{ notConfirmNum }}</uni-text>\n                            <uni-text class=\"label\">未收运</uni-text>\n                        </view>\n                        <view class=\"stat-item\">\n                            <image src=\"/static/ssd/bluebg.png\" mode=\"aspectFill\"></image>\n                            <uni-text class=\"value blue\">{{ weightNum }}</uni-text>\n                            <uni-text class=\"label\">总重量</uni-text>\n                        </view>\n                    </view>\n                </view>\n            </view>\n        </view>\n        <view class=\"weight-section\">\n            <uni-text class=\"weight-header\">过磅信息 </uni-text>\n            <view class=\"weight-content\">\n                <image src=\"/static/ssd/gbicon.png\" mode=\"aspectFill\"></image>\n                <uni-text class=\"weight-title\">重量：</uni-text>\n                <input class=\"weight-input\" type=\"number\" v-model=\"weightInput\" placeholder=\"0\" />\n                <uni-text class=\"weight-unit\">kg</uni-text>\n                <uni-button size=\"mini\" type=\"primary\" class=\"tj-btn\">提交重量</uni-button>\n\n            </view>\n        </view>\n        <view class=\"task-list\">\n            <view class=\"task-item\">\n                <view class=\"task-header\">\n                    <view class=\"time-info\">\n                        <uni-text class=\"date\">2025-08-24 14:30</uni-text>\n                    </view>\n                    <uni-text class=\"status processing\">进行中</uni-text>\n                </view>\n                <view class=\"task-content\">\n                    <view class=\"merchant-info\">\n                        <uni-text class=\"label\">商户名称：</uni-text>\n                        <uni-text class=\"value\">三顾冒菜</uni-text>\n                    </view>\n                    <view class=\"weight-info\">\n                        <uni-text class=\"label\">预估重量：</uni-text>\n                        <uni-text class=\"value\">1.46kg</uni-text>\n                    </view>\n                    <view class=\"bin-info\">\n                        <uni-text class=\"label\">桶数：</uni-text>\n                        <uni-text class=\"value\">{{ bucketNum }}个</uni-text>\n                    </view>\n                    <view class=\"address-info\">\n                        <uni-text class=\"label\">地址：</uni-text>\n                        <uni-text class=\"value\">成都市锦江区春熙路123号</uni-text>\n                        <uni-icons type=\"location\" size=\"16\" color=\"#00B578\"></uni-icons>\n                    </view>\n                </view>\n                <view class=\"task-footer\">\n                    <uni-button size=\"mini\" class=\"cancel-btn\">取消</uni-button>\n                    <uni-button size=\"mini\" type=\"primary\" class=\"view-btn\">查看</uni-button>\n                </view>\n            </view>\n        </view>\n    </view>\n\n</template>\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useUserStore } from '@/stores/user.js'\nimport { apiGetDriverInfo, apiGetDriverTodayPlan } from '@/api/apis.js'\n\n// 获取当前日期并格式化为 YYYY-MM-DD 格式\nconst getCurrentDate = () => {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n};\n\nconst userStore = useUserStore()\nconst weightNum = ref(0) // 已收运总量\nconst notConfirmNum = ref(0) // 未收运\nconst confirmNum = ref(0) // 已收运\nconst bucketNum = ref(0) // 垃圾桶数\nconst registrationNumber = ref('') // 车牌号\nconst name = ref('') // 司机名称\nconst currentDate = getCurrentDate() // 当前日期\nconst weightValue = ref('') // 重量输入框的值\n\n// 计算进度百分比\nconst progressPercentage = computed(() => {\n   \n    if (confirmNum === 0 && weightNum === 0) return 0;\n    console.log('confirmNum:', confirmNum.value, 'weightNum:', weightNum.value);\n    return Math.round((confirmNum.value / weightNum.value) * 100);\n});\n\nonMounted(async () => {\n    // 页面加载时的逻辑\n    try {\n        const userInfo = await userStore.ensureUserInfo()\n        if (userInfo === null) {\n            // 用户未登录，已跳转到登录页，不需要继续执行\n            console.log('用户未登录，已跳转到登录页')\n            return\n        }\n        getapiGetDriverInfo();\n        getapiGetDriverTodayPlan();\n    } catch (error) {\n        // 其他非401错误的处理\n        console.error('页面初始化失败:', error)\n    }\n})\n\n//获取今日统计信息\nconst getapiGetDriverInfo = async () => {\n    const res = await apiGetDriverInfo({\n        driverId: userStore.sfmerchant?.id\n    })\n\n    if (res.code === 200) {\n        //confirmNum.value = res.data.confirmNum;\n        confirmNum.value = 20;\n        notConfirmNum.value = res.data.notConfirmNum;\n        // weightNum.value = res.data.weightNum;\n        weightNum.value = 100;\n        bucketNum.value = res.data.bucketNum;\n        registrationNumber.value = res.data.registrationNumber;\n        name.value = res.data.name;\n    }\n}\n\n//司机今日收运管理列表\nconst getapiGetDriverTodayPlan = async () => {\n    const res = await apiGetDriverTodayPlan({\n        driverId: userStore.sfmerchant?.id,\n        page: 1,\n        pageSize: 10\n    })\n\n    if (res.code === 200) {\n        taskList.value = res.data.records;\n    }\n}\n\n\n// 组件逻辑\n</script>\n\n<style scoped lang=\"scss\">\n.container {\n    padding: 30rpx;\n    background-color: $bg-theme-color;\n    height: 100vh;\n    \n    .header-progress-container {\n        background: #FFFFFF;\n        border-radius: 16rpx;\n        padding: 30rpx;\n        margin-bottom: 20rpx;\n    }\n\n    .header {\n        background: none;\n        border-radius: 0;\n        padding: 0;\n        margin-bottom: 0;\n\n        .header-title {\n            margin-bottom: 20rpx;\n\n            .title {\n                font-size: 16px;\n                font-weight: 500;\n                color: #333333;\n            }\n        }\n\n        .driver-info {\n            display: flex;\n            flex-direction: column;\n            gap: 20rpx;\n\n            .info-item {\n                display: flex;\n                align-items: center;\n\n                .label {\n                    color: rgba(61, 61, 61, 0.50);\n                    font-size: 28rpx;\n                }\n\n                .value {\n                    color: rgba(61, 61, 61, 1);\n                    font-size: 14px;\n                }\n\n                .contact-btn {\n                    margin-left: auto;\n                    color: #07C160;\n                    border-radius: 100rpx;\n                    padding: 6rpx 20rpx;\n                    border: 2rpx solid #07C160;\n                    font-size: 26rpx;\n                }\n            }\n        }\n    }\n    \n    .divider {\n        height: 2rpx;\n        background-color: #f0f0f0;\n        margin: 20rpx 0;\n    }\n\n    .progress-section {\n        background: none;\n        border-radius: 0;\n        padding: 0;\n        margin-bottom: 0;\n\n        .progress-title {\n            font-size: 34rpx;\n            color: rgba(61, 61, 61, 1);\n            margin-bottom: 30rpx;\n        }\n\n        .progress-content {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n\n            .progress-circle {\n                width: 200rpx;\n                height: 200rpx;\n                border-radius: 50%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                position: relative;\n\n                .circle-text {\n                    text-align: center;\n                    background: white;\n                    border-radius: 50%;\n                    width: 170rpx;\n                    height: 170rpx;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    flex-direction: column;\n                    \n                    .percentage {\n                        font-size: 48rpx;\n                        color: #07C160;\n                        font-weight: 400;\n                        display: block;\n                    }\n\n                    .label {\n                        font-size: 24rpx;\n                        color: rgba(61, 61, 61, 0.50);\n                    }\n                }\n            }\n\n            .progress-stats {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                margin-left: 40rpx;\n                gap: 20rpx;\n                align-items: flex-end;\n\n                .stat-item {\n                    width: 300rpx;\n                    height: 88rpx;\n                    display: flex;\n                    flex-direction: column;\n                    justify-content: center;\n                    align-items: center;\n                    position: relative;\n                    \n                    image {\n                        width: 100%;\n                        height: 100%;\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        z-index: 0;\n                    }\n                    \n                    .value {\n                        font-size: 32rpx;\n                        font-weight: 500;\n                        display: block;\n                        z-index: 1;\n                        text-align: center;\n\n                        &.green {\n                            color: rgba(7, 193, 96, 1);\n                        }\n\n                        &.orange {\n                            color: rgba(255, 161, 0, 1);\n                        }\n\n                        &.blue {\n                            color: rgba(0, 170, 255, 1);\n                        }\n                    }\n\n                    .label {\n                        font-size: 24rpx;\n                        color: rgba(61, 61, 61, 0.50);\n                        z-index: 1;\n                        text-align: center;\n                    }\n                }\n            }\n        }\n    }\n\n    .weight-section {\n        background: #FFFFFF;\n        border-radius: 16rpx;\n        padding: 30rpx;\n        margin-bottom: 10rpx;\n\n        .weight-header {\n            font-size: 34rpx;\n            color: rgba(61, 61, 61, 1);\n            display: block;\n            margin-bottom: 20rpx;\n        }\n        \n        .weight-content {\n            display: flex;\n            align-items: center;\n            image{\n                width: 80rpx;\n                height: 80rpx;\n                margin-right: 40rpx;\n            }\n\n            .weight-title {\n                font-size: 14px;\n                color: #333333;\n            }\n\n            .weight-input {\n                margin: 0 10rpx;\n                padding: 10rpx 20rpx;\n                border: 1rpx solid #ddd;\n                border-radius: 10rpx;\n                font-size: 14px;\n                width: 120rpx;\n                text-align: center;\n            }\n\n            .weight-unit {\n                font-size: 14px;\n                color: #999999;\n                margin-left: 10rpx;\n            }\n\n            .weight-btn {\n                margin-left: auto;\n                background-color: #00B578;\n            }\n        }\n\n\n        .tj-btn {\n            margin-left: auto;\n            color: #07C160;\n            border-radius: 100rpx;\n            padding: 6rpx 20rpx;\n            border: 2rpx solid #07C160;\n            font-size: 26rpx;\n        }\n    }\n\n    .task-list {\n        margin-top: 20rpx;\n\n        .task-item {\n            background: #FFFFFF;\n            border-radius: 16rpx;\n            padding: 30rpx;\n            margin-bottom: 20rpx;\n\n            .task-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 20rpx;\n\n                .time-info {\n                    display: flex;\n                    align-items: center;\n                    gap: 10rpx;\n\n                    .date {\n                        font-size: 14px;\n                        color: #666666;\n                    }\n                }\n\n                .status {\n                    font-size: 12px;\n                    padding: 4rpx 16rpx;\n                    border-radius: 4rpx;\n\n                    &.processing {\n                        color: #00B578;\n                        background: rgba(0, 181, 120, 0.1);\n                    }\n                }\n            }\n\n            .task-content {\n                display: flex;\n                flex-direction: column;\n                gap: 20rpx;\n\n                .merchant-info,\n                .weight-info,\n                .bin-info,\n                .address-info {\n                    display: flex;\n                    align-items: center;\n                    gap: 10rpx;\n\n                    .label {\n                        color: #666666;\n                        font-size: 14px;\n                    }\n\n                    .value {\n                        color: #333333;\n                        font-size: 14px;\n                    }\n                }\n            }\n\n            .task-footer {\n                margin-top: 30rpx;\n                display: flex;\n                justify-content: flex-end;\n                gap: 20rpx;\n\n                .cancel-btn {\n                        color: #07C160;\n                        border-radius: 100rpx;\n                        padding: 6rpx 20rpx;\n                        border: 2rpx solid #07C160;\n                        font-size: 26rpx;\n                }\n\n                .view-btn {\n                        color: #07C160;\n                        border-radius: 100rpx;\n                        padding: 6rpx 20rpx;\n                        border: 2rpx solid #07C160;\n                        font-size: 26rpx;\n                }\n            }\n        }\n    }\n}\n</style>\n\n\n<!-- address: \"成都\"\nappointmentTime: \"2025-09-11\"\narrivalTime: null\nbucketNum: null\ncarId: 1\ncontactTel: \"18628003126\"\ncontactTruename: \"1yx\"\ncreateTime: \"2025-09-11 09:45:09\"\ndriverId: 3\ndriverName: \"李是\"\nestimateBucketNum: 4\nestimateWeight: 4\nid: 5\nlat: \"30.63706\"\nlon: \"104.08276\"\nmerchantCode: null\nmerchantConfirm: null\nmerchantId: 448\nmerchantName: \"杨洵测试\"\nrecordNo: \"1_20250911\"\nregistrationNumber: null\nstatus: 0\ntrashWeight: null\ntype: 0\nupdateTime: null\nweight: null -->","import MiniProgramPage from '/Users/yx/Documents/Vue3Projects/cycl/pages/collection/sfDetails.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","computed","uni","onMounted","apiGetDriverInfo","apiGetDriverTodayPlan"],"mappings":";;;;;;;;;;;;;;;;;;;;AA+GA,UAAM,iBAAiB,MAAM;AACzB,YAAM,OAAO,oBAAI;AACjB,YAAM,OAAO,KAAK;AAClB,YAAM,QAAQ,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG;AACzD,YAAM,MAAM,OAAO,KAAK,QAAS,CAAA,EAAE,SAAS,GAAG,GAAG;AAClD,aAAO,GAAG,IAAI,IAAI,KAAK,IAAI,GAAG;AAAA,IAClC;AAEA,UAAM,YAAYA,YAAAA,aAAc;AAChC,UAAM,YAAYC,cAAG,IAAC,CAAC;AACvB,UAAM,gBAAgBA,cAAG,IAAC,CAAC;AAC3B,UAAM,aAAaA,cAAG,IAAC,CAAC;AACxB,UAAM,YAAYA,cAAG,IAAC,CAAC;AACvB,UAAM,qBAAqBA,cAAG,IAAC,EAAE;AACjC,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,cAAc,eAAgB;AAChBA,kBAAG,IAAC,EAAE;AAG1B,UAAM,qBAAqBC,cAAQ,SAAC,MAAM;AAEtC,UAAI,eAAe,KAAK,cAAc;AAAG,eAAO;AAChDC,oBAAAA,MAAA,MAAA,OAAA,yCAAY,eAAe,WAAW,OAAO,cAAc,UAAU,KAAK;AAC1E,aAAO,KAAK,MAAO,WAAW,QAAQ,UAAU,QAAS,GAAG;AAAA,IAChE,CAAC;AAEDC,kBAAAA,UAAU,YAAY;AAElB,UAAI;AACA,cAAM,WAAW,MAAM,UAAU,eAAgB;AACjD,YAAI,aAAa,MAAM;AAEnBD,wBAAAA,MAAY,MAAA,OAAA,yCAAA,eAAe;AAC3B;AAAA,QACH;AACD;AACA;MACH,SAAQ,OAAO;AAEZA,sBAAAA,MAAA,MAAA,SAAA,yCAAc,YAAY,KAAK;AAAA,MAClC;AAAA,IACL,CAAC;AAGD,UAAM,sBAAsB,YAAY;;AACpC,YAAM,MAAM,MAAME,0BAAiB;AAAA,QAC/B,WAAU,eAAU,eAAV,mBAAsB;AAAA,MACxC,CAAK;AAED,UAAI,IAAI,SAAS,KAAK;AAElB,mBAAW,QAAQ;AACnB,sBAAc,QAAQ,IAAI,KAAK;AAE/B,kBAAU,QAAQ;AAClB,kBAAU,QAAQ,IAAI,KAAK;AAC3B,2BAAmB,QAAQ,IAAI,KAAK;AACpC,aAAK,QAAQ,IAAI,KAAK;AAAA,MACzB;AAAA,IACL;AAGA,UAAM,2BAA2B,YAAY;;AACzC,YAAM,MAAM,MAAMC,+BAAsB;AAAA,QACpC,WAAU,eAAU,eAAV,mBAAsB;AAAA,QAChC,MAAM;AAAA,QACN,UAAU;AAAA,MAClB,CAAK;AAED,UAAI,IAAI,SAAS,KAAK;AAClB,iBAAS,QAAQ,IAAI,KAAK;AAAA,MAC7B;AAAA,IACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtLA,GAAG,WAAW,eAAe;"}