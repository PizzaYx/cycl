{"version":3,"file":"syReport.js","sources":["pages/collection/syReport.vue","pages/collection/syReport.vue?type=page"],"sourcesContent":["<!-- 收运上报 -->\n<template>\n    <view class=\"container\">\n        <uni-nav-bar dark :fixed=\"true\" background-color=\"#fff\" status-bar left-icon=\"left\" color=\"#000\" title=\"收运上报\"\n            @clickLeft=\"back\" />\n        <!-- 添加商店信息和扫码区域 -->\n        <view class=\"store-info\">\n            <view class=\"store-name\">商店名称: {{ merchantName }}</view>\n            <view class=\"bin-info\">\n                <text>垃圾桶个数: {{ ljNum }}个</text>\n                <uni-icons type=\"scan\" size=\"30\" color=\"#07C160\" class=\"scan-icon\" @click=\"handleScan\" />\n            </view>\n        </view>\n        <scroll-view class=\"content\" scroll-y>\n            <view class=\"record-list\">\n                <!-- 当没有数据时显示提示 -->\n                <view v-if=\"records.length === 0\" class=\"empty-tip\">\n                    <text>请点击扫码按钮添加垃圾桶数据</text>\n                </view>\n\n                <!-- 有数据时显示记录列表 -->\n                <view v-for=\"(item, index) in records\" :key=\"index\" class=\"record-card\">\n                    <view class=\"input-group\">\n                        <view class=\"input-item\">\n                            <text class=\"label\"><text class=\"required\">*</text>垃圾桶数（个）</text>\n                            <input type=\"number\" v-model=\"item.binCount\" class=\"input underline-input readonly\" disabled\n                                placeholder=\"1\" />\n                        </view>\n                        <view class=\"input-item\">\n                            <text class=\"label\"><text class=\"required\">*</text>厨余垃圾重量（kg）</text>\n                            <view class=\"weight-input-container\">\n                                <input type=\"number\" v-model=\"item.weight\" class=\"input underline-input\"\n                                    :class=\"{ 'readonly-input': item.isConfirmed }\" :disabled=\"item.isConfirmed\"\n                                    placeholder=\"请输入垃圾重量\" />\n                                <button class=\"get-weight-btn\" @tap=\"handleGetWeight(index)\"\n                                    :disabled=\"item.isConfirmed\">获取重量</button>\n                            </view>\n                        </view>\n                    </view>\n\n                    <view class=\"upload-section\">\n                        <text class=\"label\"><text class=\"required\">*</text>厨余垃圾照片</text>\n                        <view class=\"upload-area\">\n                            <uni-file-picker v-model=\"item.images\" file-mediatype=\"image\" :limit=\"maxImageCount\"\n                                :upload-url=\"uploadUrl\" :header=\"uploadHeaders\" :disabled=\"item.isConfirmed\"\n                                :readonly=\"item.isConfirmed\" return-type=\"array\"\n                                @select=\"(e) => handleFileSelect(e, index)\">\n                            </uni-file-picker>\n                            <text class=\"upload-tip\">最多可上传{{ maxImageCount }}张图片，每张图片不超过3M</text>\n                        </view>\n                    </view>\n\n                    <view class=\"button-group\">\n                        <button v-if=\"!item.isConfirmed\" class=\"btn btn-cancel\" @click=\"handleCancel(index)\">取消</button>\n                        <button v-if=\"!item.isConfirmed\" class=\"btn btn-confirm\"\n                            @click=\"handleConfirm(index)\">确认</button>\n                    </view>\n                </view>\n            </view>\n        </scroll-view>\n\n        <!-- 固定底部按钮 -->\n        <view class=\"bottom-button\">\n            <button class=\"btn-complete\" @click=\"getSyCheckDetail\">收运完成</button>\n        </view>\n    </view>\n</template>\n\n<script setup>\n// @ts-nocheck\nimport { ref } from 'vue';\nimport { onLoad, onUnload } from '@dcloudio/uni-app'; // 正确导入onLoad生命周期\nimport { uploadUrl, createUploadHeaders } from '@/utils/config.js';\nimport { apiPostreportWeight, apiGetDriverPlanById, apiGetdriverConfirmPlan } from '@/api/apis.js'\nimport { useUserStore } from '@/stores/user.js'\n\n// 返回上一页\nconst back = () => {\n    // 返回前发送事件通知sfDetails页面刷新\n    uni.$emit('refreshSfDetails');\n    uni.navigateBack();\n};\n\nconst ljNum = ref(0); // 垃圾桶数量\nconst maxImageCount = 3; // 最大上传图片数量\nconst maxImageSize = 3 * 1024 * 1024; // 每张图片最大大小 3M\n\n// 新增接收页面参数的变量\nconst carId = ref(''); // 车辆ID\nconst driverId = ref(''); // 司机ID\nconst merchantId = ref(''); // 商户ID\nconst planId = ref(''); // 收运单ID\nconst merchantName = ref('')//商家名称\n\n// 文件上传配置\nconst uploadHeaders = createUploadHeaders().value // 添加 .value 获取实际值\nconst userStore = useUserStore()\n\nconst records = ref([]);\n\n// 页面加载时获取传入的参数\nonLoad((options) => {\n    if (options.carId) carId.value = options.carId;\n    if (options.driverId) driverId.value = options.driverId;\n    if (options.merchantId) merchantId.value = options.merchantId;\n    if (options.planId) planId.value = options.planId;\n    if (options.merchantName) merchantName.value = options.merchantName;\n    console.log('接收到的参数:', options);\n});\n\n// 文件选择事件处理\nconst handleFileSelect = (event, index) => {\n    console.log('选择了图片')\n    console.log('uploadUrl:', uploadUrl)\n    console.log('uploadHeaders:', uploadHeaders)\n    console.log('event:', event)\n\n    // 手动更新对应记录的images数据\n    if (event.tempFiles && event.tempFiles.length > 0) {\n        const newImages = [...(records.value[index].images || []), ...event.tempFiles];\n        records.value[index].images = newImages;\n\n        // 手动上传文件\n        uploadFileManually(event.tempFiles[0], index)\n    }\n};\n\n// 手动上传文件\nconst uploadFileManually = (file, index) => {\n    console.log('开始手动上传文件:', file)\n    console.log('文件路径:', file.tempFilePath || file.path)\n    console.log('上传URL:', uploadUrl)\n    console.log('请求头:', uploadHeaders)\n\n    uni.uploadFile({\n        url: uploadUrl,\n        filePath: file.tempFilePath || file.path,\n        name: 'file',\n        header: uploadHeaders,\n        success: (res) => {\n            console.log('手动上传成功:', res)\n            // 处理上传成功\n            const response = JSON.parse(res.data)\n            console.log('服务器响应:', response)\n\n            if (response.code === 200 && response.url) {\n                // 更新文件信息\n                records.value[index].images[records.value[index].images.length - 1] = {\n                    ...file,\n                    url: response.url,\n                    fileName: response.fileName,\n                    newFileName: response.newFileName,\n                    originalFilename: response.originalFilename,\n                    response: response\n                }\n                console.log('文件上传成功，URL:', response.url)\n            } else {\n                console.log('上传失败，服务器返回:', response)\n            }\n        },\n        fail: (err) => {\n            console.log('手动上传失败:', err)\n            console.log('错误详情:', JSON.stringify(err))\n        }\n    })\n};\n\n// 获取重量按钮点击事件\nconst handleGetWeight = (index) => {\n    console.log('获取重量按钮点击', { index, record: records.value[index] });\n    // TODO: 在这里添加获取重量的具体逻辑\n};\n\n// 获取收运详情\nconst getSyCheckDetail = async () => {\n    // 先检查本地是否有已确认的记录\n    const confirmedRecords = records.value.filter(record => record.isConfirmed === true);\n\n    if (confirmedRecords.length === 0) {\n        uni.showToast({\n            title: '请先进行收运上报操作并确认数据',\n            icon: 'none'\n        });\n        return;\n    }\n\n    try {\n        const res = await apiGetDriverPlanById({\n            driverId: driverId.value,\n            id: planId.value\n        })\n\n        if (res.code === 200) {\n            const data = res.data;\n            collectTask(data);\n            console.log('详情', data);\n        } else {\n            uni.showToast({\n                title: res.msg || '获取详情失败',\n                icon: 'none'\n            });\n        }\n    } catch (error) {\n        console.error('获取详情异常:', error);\n        uni.showToast({\n            title: '获取详情异常',\n            icon: 'none'\n        });\n    }\n}\n\n// 收运完成\nconst collectTask = (task) => {\n    console.log('收运:', task.id);\n\n    // 检查服务器返回的数据，判断是否有上报数据\n    if (task.weight > 0 && task.bucketNum > 0) {\n        //确认收运完成\n        uni.showModal({\n            title: '确认收运完成',\n            content: '是否确认收运完成？',\n            success: async (res) => {\n                if (res.confirm) {\n                    try {\n                        const confirmRes = await apiGetdriverConfirmPlan({\n                            id: task.id,\n                            driverId: userStore.sfmerchant?.id,\n                        });\n\n                        if (confirmRes.code === 200) {\n                            uni.showToast({\n                                title: confirmRes.msg || '操作成功',\n                                icon: 'success'\n                            });\n                            // 返回上一页\n                            setTimeout(() => {\n                                back();\n                            }, 1500);\n                        } else {\n                            uni.showToast({\n                                title: confirmRes.msg || '操作失败',\n                                icon: 'error'\n                            });\n                        }\n                    } catch (error) {\n                        console.error('确认收运异常:', error);\n                        uni.showToast({\n                            title: '操作异常',\n                            icon: 'none'\n                        });\n                    }\n                }\n            }\n        })\n    }\n    else {\n        uni.showToast({\n            title: '服务器未检测到上报数据，请先进行收运上报操作',\n            icon: 'none'\n        });\n        return;\n    }\n};\n\n// 验证扫码结果格式\nconst validateScanResult = (scanResult) => {\n    if (!scanResult || typeof scanResult !== 'string') {\n        return false;\n    }\n\n    // 检查是否包含下划线\n    if (!scanResult.includes('_')) {\n        return false;\n    }\n\n    // 检查是否可以用下划线分割成2段\n    const parts = scanResult.split('_');\n    if (parts.length !== 2) {\n        return false;\n    }\n\n    // 检查两段都不为空\n    if (!parts[0] || !parts[1]) {\n        return false;\n    }\n\n    // 可以添加更多验证规则，比如：\n    // - 第一段是否为数字（桶编号）\n    // - 第二段是否为时间格式（20250913145507）\n    const bucketId = parts[0];\n    const timestamp = parts[1];\n\n    // 验证桶编号是否为数字\n    if (!/^\\d+$/.test(bucketId)) {\n        return false;\n    }\n\n    // 验证时间戳格式（14位数字）\n    if (!/^\\d{14}$/.test(timestamp)) {\n        return false;\n    }\n\n    return true;\n};\n\nconst handleScan = () => {\n    // @ts-ignore\n    uni.scanCode({\n        success: (res) => {\n            console.log('扫码结果', res);\n\n            // 验证扫码结果格式\n            if (!validateScanResult(res.result)) {\n                uni.showToast({\n                    title: '扫码格式不正确，请扫描正确的桶码',\n                    icon: 'none'\n                });\n                return;\n            }\n\n            // 验证商户ID是否匹配\n            const scanResult = res.result;\n            const parts = scanResult.split('_');\n            const scannedMerchantId = parts[0]; // 下划线前面的是商户ID\n\n            console.log('扫码结果:', scanResult);\n            console.log('扫码中的商户ID:', scannedMerchantId);\n            console.log('当前商户ID:', merchantId.value);\n\n            if (scannedMerchantId !== merchantId.value) {\n                uni.showToast({\n                    title: '桶码不属于当前商户，请扫描正确的桶码',\n                    icon: 'none'\n                });\n                return;\n            }\n\n            // 检查是否已经扫描过相同的桶码\n            const existingRecord = records.value.find(record => record.bucketCode === res.result);\n            if (existingRecord) {\n                uni.showToast({\n                    title: '该桶码已扫描，请勿重复扫描',\n                    icon: 'none'\n                });\n                return;\n            }\n\n            // 扫描成功后添加一条新记录\n            records.value.push({\n                binCount: '',\n                weight: '',\n                images: [],\n                isConfirmed: false, // 添加确认状态\n                bucketCode: res.result // 添加桶编码\n            });\n            // 增加垃圾桶数量\n            ljNum.value++;\n\n            uni.showToast({\n                title: '扫码成功',\n                icon: 'success'\n            });\n        },\n        fail: (err) => {\n            console.log('扫码失败', err);\n            uni.showToast({\n                title: '扫码失败,请重试!',\n                icon: 'none'\n            });\n        }\n    });\n};\n\nconst handleCancel = (index) => {\n    // 弹出确认对话框\n    uni.showModal({\n        title: '确认删除',\n        content: '是否确认删除当前数据？',\n        success: (res) => {\n            if (res.confirm) {\n                // 用户点击确定，删除当前记录\n                records.value.splice(index, 1);\n                // 减少垃圾桶数量\n                ljNum.value--;\n            }\n        }\n    });\n};\n\n//验证\nconst handleConfirm = (index) => {\n    const record = records.value[index];\n\n    // 验证重量是否输入\n    if (!record.weight || record.weight.trim() === '') {\n        uni.showToast({\n            title: '请输入垃圾重量',\n            icon: 'none'\n        });\n        return;\n    }\n\n    // 验证是否至少上传了一张图片\n    // 1. 检查数据是否存在\n    if (record.images === undefined || record.images === null) {\n        uni.showToast({\n            title: '请至少上传1张图片',\n            icon: 'none'\n        });\n        return;\n    }\n\n    // 2. 检查是否为数组\n    if (!Array.isArray(record.images)) {\n        uni.showToast({\n            title: '请至少上传1张图片',\n            icon: 'none'\n        });\n        return;\n    }\n\n    // 3. 检查数组是否为空\n    if (record.images.length === 0) {\n        uni.showToast({\n            title: '请至少上传1张图片',\n            icon: 'none'\n        });\n        return;\n    }\n\n    // 4. 检查是否有有效的文件\n    const validFiles = record.images.filter((file) => {\n        if (!file) {\n            return false;\n        }\n\n        // 检查各种可能的文件格式\n        const hasUrl = file.url && file.url.trim();\n        const hasPath = file.path && file.path.trim();\n        const hasResponse = file.response && file.response.url;\n        const isString = typeof file === 'string' && file.trim();\n        const hasFileId = file.fileID || file.id;\n        const hasName = file.name;\n        const hasSize = file.size;\n        const hasTempFilePath = file.tempFilePath;\n        const hasFile = file.file;\n\n        const isValid = hasUrl || hasPath || hasResponse || isString || hasFileId || hasName || hasSize || hasTempFilePath || hasFile;\n        return isValid;\n    });\n\n    if (validFiles.length === 0) {\n        uni.showToast({\n            title: '请至少上传1张图片',\n            icon: 'none'\n        });\n        return;\n    }\n\n    // 检查文件数量限制\n    if (validFiles.length > maxImageCount) {\n        uni.showToast({\n            title: `最多只能上传${maxImageCount}张图片`,\n            icon: 'none'\n        });\n        return;\n    }\n\n\n    confirmReport(index);\n\n};\n\n//确认收运上报\nconst confirmReport = async (index) => {\n    const record = records.value[index];\n    // 从扫码结果中获取桶编码数据，如果没有则使用默认值\n    const bucketCode = record.bucketCode || ('BC' + new Date().getTime());\n\n    // 构造上报数据\n    const reportData = {\n        bucketCode: bucketCode, // 桶编码\n        weight: parseFloat(record.weight), // 垃圾重量改为小数类型\n        carId: carId.value, // 车辆ID\n        driverId: driverId.value, // 司机ID\n        merchantId: merchantId.value, // 商户ID\n        planId: planId.value, // 收运单ID\n        img: record.images.map(image => {\n            console.log('处理图片数据:', image);\n            console.log('图片URL:', image.url);\n            console.log('图片路径:', image.path);\n            console.log('图片响应:', image.response);\n\n            // 根据不同情况获取图片URL\n            if (image.url) {\n                console.log('使用image.url:', image.url);\n                return image.url;\n            }\n            if (image.path) {\n                console.log('使用image.path:', image.path);\n                return image.path;\n            }\n            if (image.response && image.response.url) {\n                console.log('使用image.response.url:', image.response.url);\n                return image.response.url;\n            }\n            if (typeof image === 'string') {\n                console.log('使用字符串:', image);\n                return image;\n            }\n            console.log('没有找到有效的URL');\n            return '';\n        }).filter(url => url !== '') // 过滤掉空的URL\n    };\n\n    // 将过滤后的URL用逗号连接\n    reportData.img = reportData.img.join(',');\n\n    console.log('最终上报的图片URLs:', reportData.img);\n    console.log('完整上报数据:', reportData);\n\n    try {\n        const res = await apiPostreportWeight(reportData);\n        if (res.code === 200) {\n            uni.showToast({\n                title: '上报成功',\n                icon: 'success'\n            });\n\n            // 设置为已确认状态\n            record.isConfirmed = true;\n        } else {\n\n            uni.showToast({\n                title: res.msg || '上报失败',\n                icon: 'none'\n            });\n        }\n    } catch (error) {\n        uni.showToast({\n            title: '上报异常',\n            icon: 'none'\n        });\n        console.error('上报异常:', error);\n    }\n};\n\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n    height: 100vh;\n    display: flex;\n    flex-direction: column;\n    background-color: $bg-theme-color;\n}\n\n// 添加商店信息样式\n.store-info {\n    padding: 24rpx;\n    background-color: #FFFFFF;\n    margin: 20rpx;\n    border-radius: 20rpx;\n\n    .store-name {\n        font-size: 30rpx;\n        font-weight: 500;\n        color: #333333;\n        margin-bottom: 16rpx;\n    }\n\n    .bin-info {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        font-size: 28rpx;\n        color: #666666;\n\n        .scan-icon {\n            cursor: pointer;\n        }\n    }\n}\n\n.content {\n    flex: 1;\n    overflow: auto;\n    padding-bottom: 120rpx; // 为底部按钮留出空间\n\n    .record-list {\n        padding: 24rpx;\n\n        .empty-tip {\n            text-align: center;\n            padding: 120rpx 0;\n            color: #999999;\n            font-size: 34rpx;\n        }\n\n        .record-card {\n            background-color: #FFFFFF;\n            border-radius: 16rpx;\n            padding: 32rpx;\n            margin-bottom: 24rpx;\n\n            .input-group {\n                margin-bottom: 32rpx;\n\n                .input-item {\n                    margin-bottom: 24rpx;\n\n                    &:last-child {\n                        margin-bottom: 0;\n                    }\n\n                    .label {\n                        display: block;\n                        font-size: 14px;\n                        color: #333333;\n                        margin-bottom: 16rpx;\n\n                        .required {\n                            color: #FF4D4F;\n                            margin-right: 8rpx;\n                        }\n                    }\n\n                    .input {\n                        height: 88rpx;\n                        background-color: #F5F5F5;\n                        border-radius: 8rpx;\n                        padding: 0 24rpx;\n                        font-size: 14px;\n                    }\n\n                    // 重量输入容器样式\n                    .weight-input-container {\n                        display: flex;\n                        align-items: center;\n                        gap: 16rpx;\n\n                        .input {\n                            flex: 1;\n                        }\n\n                        .get-weight-btn {\n                            width: 120rpx;\n                            height: 54rpx;\n                            background-color: #07C160;\n                            color: #FFFFFF;\n                            border: none;\n                            border-radius: 32rpx;\n                            font-size: 24rpx;\n                            font-weight: 500;\n                            line-height: 54rpx;\n                            text-align: center;\n                            white-space: nowrap;\n                            display: flex;\n                            align-items: center;\n                            justify-content: center;\n\n                            &:active {\n                                background-color: #06AD56;\n                            }\n\n                            &[disabled] {\n                                background-color: #CCCCCC;\n                                color: #fff;\n                            }\n                        }\n                    }\n\n                    // 下划线样式输入框\n                    .underline-input {\n                        height: 88rpx;\n                        background-color: transparent;\n                        border: none;\n                        border-bottom: 1px solid #e0e0e0;\n                        border-radius: 0;\n                        padding: 0 8rpx;\n                        font-size: 14px;\n                        box-shadow: none;\n\n                        &:focus {\n                            outline: none;\n                            border-bottom: 1px solid #07C160;\n                        }\n\n                        // 只读状态样式\n                        &[disabled] {\n                            background-color: #f5f5f5;\n                            color: #999;\n                            -webkit-text-fill-color: #999; // 防止iOS设备上disabled文字变淡\n                            opacity: 1; // 防止某些浏览器中disabled元素透明度变化\n                        }\n\n                        &.readonly-input {\n                            background-color: #f5f5f5;\n                            color: #999;\n                        }\n                    }\n                }\n            }\n\n            .upload-section {\n                margin-bottom: 32rpx;\n\n                .label {\n                    display: block;\n                    font-size: 14px;\n                    color: #333333;\n                    margin-bottom: 16rpx;\n\n                    .required {\n                        color: #FF4D4F;\n                        margin-right: 8rpx;\n                    }\n                }\n\n                .upload-area {\n                    margin-top: 16rpx;\n\n                    .upload-tip {\n                        font-size: 24rpx;\n                        color: #999999;\n                        line-height: 1.5;\n                        margin-top: 16rpx;\n                    }\n                }\n            }\n\n            .button-group {\n                position: relative;\n                height: 48rpx;\n                margin-top: 32rpx;\n\n                .btn {\n                    position: absolute;\n                    right: 0;\n                    width: 144rpx;\n                    height: 48rpx;\n                    line-height: 48rpx;\n                    text-align: center;\n                    border-radius: 100rpx;\n                    font-size: 14px;\n\n                    &.btn-cancel {\n                        right: 164rpx;\n                        /* 144rpx宽度 + 20rpx间距 */\n                        background-color: #F5F5F5;\n                        color: #666666;\n                    }\n\n                    &.btn-confirm {\n                        right: 0;\n                        background-color: #07C160;\n                        color: #FFFFFF;\n                    }\n                }\n            }\n        }\n    }\n}\n\n// 底部固定按钮样式\n.bottom-button {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background-color: #FFFFFF;\n    padding: 24rpx;\n    border-top: 1px solid #E5E5E5;\n    z-index: 999;\n\n    .btn-complete {\n        width: 100%;\n        height: 88rpx;\n        background-color: #07C160;\n        color: #FFFFFF;\n        border: none;\n        border-radius: 44rpx;\n        font-size: 32rpx;\n        font-weight: 500;\n        line-height: 88rpx;\n        text-align: center;\n\n        &:active {\n            background-color: #06AD56;\n        }\n    }\n}\n</style>","import MiniProgramPage from '/Users/yx/Documents/Vue3Projects/cycl/pages/collection/syReport.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","createUploadHeaders","useUserStore","onLoad","uploadUrl","apiGetDriverPlanById","apiGetdriverConfirmPlan","apiPostreportWeight"],"mappings":"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"}