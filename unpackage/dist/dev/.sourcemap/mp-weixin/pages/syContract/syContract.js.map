{"version":3,"file":"syContract.js","sources":["pages/syContract/syContract.vue","pages/syContract/syContract.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"contract-container\">\n        <!-- 导航栏 -->\n        <uni-nav-bar dark :fixed=\"true\" background-color=\"#fff\" status-bar left-icon=\"left\" color=\"#000\" title=\"合同详情\"\n            @clickLeft=\"back\" />\n\n        <!-- 合同过期提示 -->\n        <view v-if=\"contractExpired && fromMerchant\" class=\"expired-tip\">\n            <view class=\"tip-content\">\n                <uni-icons type=\"info\" size=\"16\" color=\"#ff9500\"></uni-icons>\n                <text class=\"tip-text\">您的合同已过期，请重新签署合同</text>\n            </view>\n        </view>\n\n        <!-- 合同内容区域 -->\n        <scroll-view class=\"contract-content\" scroll-y>\n            <!-- 富文本合同内容 -->\n            <view class=\"contract-body\">\n                <mp-html :content=\"contractContent\" @tap=\"onRichTextTap\"></mp-html>\n            </view>\n        </scroll-view>\n\n        <!-- 底部提交按钮（仅从merchant页面进入且可编辑时显示） -->\n        <view v-if=\"fromMerchant && !isReadOnly\" class=\"bottom-actions\">\n            <button class=\"action-btn submit-btn\" @tap=\"submitContract\" :disabled=\"!canSubmit\">\n                提交合同\n            </button>\n        </view>\n\n    </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { apiGetMerchantCovenant, apiGetCovenantTemplat, apiAddMerchantCovenant } from '@/api/apis.js'\nimport { useUserStore } from '@/stores/user.js'\n\n// 页面参数\nconst tempId = ref('') // 合同模板ID（只读模式使用）\nconst contractData = ref({})\nconst isReadOnly = ref(false) // 必传：是否为只读模式\nconst needReturnData = ref(false) // 必传：是否需要返回数据给上级页面\nconst fromMerchant = ref(false) // 是否从merchant页面进入\nconst contractExpired = ref(false) // 合同是否过期\n\n// 用户信息\nconst userStore = useUserStore()\n\n// 签名数据\nconst signatures = ref({\n    partyB: ''  // 乙方签名\n})\n\n\n// 富文本合同内容（HTML格式）\nconst contractContent = ref('')\n\n// HTML实体转码函数\nconst decodeHtmlEntities = (str) => {\n    if (!str) return ''\n    return str.replace(/&amp;/g, '&')\n        .replace(/&lt;/g, '<')\n        .replace(/&gt;/g, '>')\n        .replace(/&quot;/g, '\"')\n        .replace(/&#39;/g, \"'\")\n}\n\n// 检查合同是否过期\nconst checkContractExpiry = (endTime) => {\n    if (!endTime) return false\n\n    try {\n        // 解析结束时间（假设格式为 YYYY-MM-DD 或 YYYY年MM月DD日）\n        let endDate\n        if (endTime.includes('年') && endTime.includes('月') && endTime.includes('日')) {\n            // 处理 \"2024年12月31日\" 格式\n            const match = endTime.match(/(\\d{4})年(\\d{1,2})月(\\d{1,2})日/)\n            if (match) {\n                const [, year, month, day] = match\n                endDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day))\n            }\n        } else {\n            // 处理 \"2024-12-31\" 格式\n            endDate = new Date(endTime)\n        }\n\n        if (!endDate || isNaN(endDate.getTime())) {\n            console.warn('无法解析合同结束时间:', endTime)\n            return false\n        }\n\n        const currentDate = new Date()\n        currentDate.setHours(0, 0, 0, 0) // 重置时间到当天开始\n        endDate.setHours(23, 59, 59, 999) // 设置到当天结束\n\n        const isExpired = currentDate > endDate\n        console.log('合同过期检查:', {\n            endTime: endTime,\n            endDate: endDate.toISOString(),\n            currentDate: currentDate.toISOString(),\n            isExpired: isExpired\n        })\n\n        return isExpired\n    } catch (error) {\n        console.error('检查合同过期时间失败:', error)\n        return false\n    }\n}\n\n// 计算属性：是否可以提交\nconst canSubmit = computed(() => {\n    return signatures.value.partyB\n})\n\n// 页面加载\nonLoad((options) => {\n    tempId.value = options.tempId || '' // 接收合同模板ID\n    isReadOnly.value = options.isReadOnly === 'true' // 必传：是否为只读模式\n    needReturnData.value = options.needReturn === 'true' // 必传：是否需要返回数据\n    fromMerchant.value = !options.isReadOnly && !options.needReturn // 判断是否从merchant页面进入\n\n    console.log('接收到的状态参数:', {\n        isReadOnly: isReadOnly.value,\n        needReturnData: needReturnData.value,\n        tempId: tempId.value,\n        fromMerchant: fromMerchant.value\n    })\n\n    // 根据模式加载不同的数据\n    if (fromMerchant.value) {\n        // 从merchant页面进入，先尝试获取商户合同，没有则获取模板\n        loadContractForMerchant()\n    } else if (isReadOnly.value) {\n        loadMerchantCovenant()\n    } else {\n        loadCovenantTemplate()\n    }\n\n    loadSignatures()\n})\n\n// 加载商户合同（只读模式）\nconst loadMerchantCovenant = async () => {\n    console.log('加载商户合同（只读模式）', tempId.value, userStore.merchant?.id,)\n    try {\n        const result = await apiGetMerchantCovenant({\n            tempId: tempId.value,\n            merchantId: userStore.merchant?.id,\n        })\n\n        if (result.code === 200 && result.data) {\n            contractContent.value = decodeHtmlEntities(result.data.content || '')\n        } else {\n            contractContent.value = '<div style=\"text-align: center; padding: 40px; color: #999;\">暂无合同数据</div>'\n        }\n    } catch (error) {\n        uni.showToast({\n            title: '加载合同失败',\n            icon: 'none'\n        })\n        contractContent.value = '<div style=\"text-align: center; padding: 40px; color: #999;\">加载合同失败</div>'\n    }\n}\n\n// 加载合同模板（可编辑模式）\nconst loadCovenantTemplate = async () => {\n    try {\n        const result = await apiGetCovenantTemplat()\n\n        if (result.code === 200 && result.data && result.data.content) {\n            contractContent.value = decodeHtmlEntities(result.data.content)\n            contractData.value = result.data\n        } else {\n            contractContent.value = '<div style=\"text-align: center; padding: 40px; color: #999;\">暂无合同模板</div>'\n        }\n    } catch (error) {\n        console.error('加载合同模板失败:', error)\n        contractContent.value = '<div style=\"text-align: center; padding: 40px; color: #999;\">加载合同模板失败</div>'\n    }\n}\n\n// 从merchant页面进入的合同加载逻辑\nconst loadContractForMerchant = async () => {\n    try {\n        console.log('从merchant页面进入，先尝试获取商户合同')\n        // 先尝试获取商户合同\n        const merchantResult = await apiGetMerchantCovenant({\n            merchantId: userStore.merchant?.id\n        })\n\n        if (merchantResult.code === 200 && merchantResult.data && merchantResult.data.content) {\n            // 有商户合同，检查是否过期\n            const contractData = merchantResult.data\n            const isExpired = checkContractExpiry(contractData.endTime)\n\n            if (isExpired) {\n                // 合同已过期，需要重新编辑\n                console.log('合同已过期，需要重新编辑')\n                contractExpired.value = true\n                await loadCovenantTemplate()\n                isReadOnly.value = false // 设置为可编辑模式\n            } else {\n                // 合同未过期，只读显示\n                console.log('合同未过期，只读显示')\n                contractContent.value = decodeHtmlEntities(contractData.content)\n                isReadOnly.value = true // 设置为只读模式\n            }\n        } else {\n            // 没有商户合同，获取模板进入编辑模式\n            console.log('未找到商户合同，获取模板进入编辑模式')\n            await loadCovenantTemplate()\n            isReadOnly.value = false // 设置为可编辑模式\n        }\n    } catch (error) {\n        console.error('加载商户合同失败，尝试获取模板:', error)\n        // 出错时也尝试获取模板\n        await loadCovenantTemplate()\n        isReadOnly.value = false\n    }\n}\n\n// 获取当前日期\nconst getCurrentDate = () => {\n    const currentDate = new Date()\n    const year = currentDate.getFullYear()\n    const month = String(currentDate.getMonth() + 1).padStart(2, '0')\n    const day = String(currentDate.getDate()).padStart(2, '0')\n    return `${year}-${month}-${day}`\n}\n\n\n// 加载签名数据\nconst loadSignatures = () => {\n    // 初始化签名数据\n    signatures.value = {\n        partyB: ''\n    }\n}\n\n\n// 更新合同内容中的签名显示\nconst updateContractWithSignature = () => {\n    if (signatures.value.partyB) {\n        const signatureHtml = `<img src=\"${signatures.value.partyB}\" style=\"max-width: 270px; max-height: 80px; vertical-align: middle; cursor: pointer;\" alt=\"乙方签名\" />`\n        contractContent.value = contractContent.value.replace(\n            '<span id=\"signature-btn\" style=\"display: inline-block; width: 270px; height: 80px; border: 2px dashed #ccc; border-radius: 8px; margin-left: 10px; text-align: center; line-height: 76px; color: #999; font-size: 16px; cursor: pointer; background: #fafafa; transition: all 0.3s ease;\">点击此处签名</span>',\n            signatureHtml\n        )\n\n        // 签名后自动回填开始日期\n        const currentDate = getCurrentDate()\n        contractContent.value = contractContent.value.replace(\n            '<span id=\"start-date\">________________</span>',\n            `<span id=\"start-date\">${currentDate}</span>`\n        )\n    }\n}\n\n\n// 富文本点击事件\nconst onRichTextTap = (e) => {\n    console.log('富文本点击事件触发:', e)\n    // 只在非只读模式下才允许跳转到签名页面\n    if (!isReadOnly.value) {\n        goToSignature()\n    }\n}\n\n// 跳转到签名页面\nconst goToSignature = () => {\n    uni.navigateTo({\n        url: `/pages/syContract/shSignature`\n    })\n}\n\n\n\n// 提交合同\nconst submitContract = () => {\n    if (!canSubmit.value) {\n        uni.showToast({\n            title: '请先完成签名',\n            icon: 'none'\n        })\n        return\n    }\n\n    uni.showModal({\n        title: '确认提交',\n        content: '确定要提交合同吗？提交后将无法修改。',\n        success: (res) => {\n            if (res.confirm) {\n                submitContractToServer()\n            }\n        }\n    })\n}\n\n// 提交合同到服务器\nconst submitContractToServer = async () => {\n    try {\n        uni.showLoading({\n            title: '提交中...'\n        })\n\n        // 创建包含签名的完整HTML内容\n        let finalContractContent = contractContent.value\n\n        // 如果已签名，确保签名图片和日期在HTML中显示\n        if (signatures.value.partyB) {\n            const signatureHtml = `<img src=\"${signatures.value.partyB}\" style=\"max-width: 300px; max-height: 80px; border-radius: 8px; vertical-align: middle; border: 1px solid #e0e0e0;\" alt=\"乙方签名\" />`\n            finalContractContent = finalContractContent.replace(\n                '<span id=\"signature-btn\" style=\"display: inline-block; width: 270px; height: 80px; border: 2px dashed #ccc; border-radius: 8px; margin-left: 10px; text-align: center; line-height: 76px; color: #999; font-size: 16px; cursor: pointer; background: #fafafa; transition: all 0.3s ease;\">点击此处签名</span>',\n                signatureHtml\n            )\n\n            // 确保日期也正确显示\n            const currentDate = getCurrentDate()\n            finalContractContent = finalContractContent.replace(\n                '<span id=\"start-date\">________________</span>',\n                `<span id=\"start-date\">${currentDate}</span>`\n            )\n        }\n\n        // 提交数据到服务器\n        try {\n            // 准备提交数据\n            const submitData = {\n                content: finalContractContent, // 富文本内容\n                merchantId: userStore.merchant?.id, // 商户ID\n                startTime: getCurrentDate(), // 开始日期\n                endTime: contractData.value.endTime, // 结束日期\n                tempId: contractData.value.id // 合同模板ID\n            }\n\n            console.log('提交合同数据:', submitData)\n\n            // 调用API提交合同\n            const response = await apiAddMerchantCovenant(submitData)\n\n            if (response.code === 200) {\n                uni.hideLoading()\n                uni.showToast({\n                    title: '合同提交成功',\n                    icon: 'success'\n                })\n\n                // 清除签名数据\n                signatures.value = {\n                    partyB: ''\n                }\n\n                // 返回上一页\n                setTimeout(() => {\n                    uni.navigateBack()\n                }, 1500)\n            } else {\n                throw new Error(response.message || '提交失败')\n            }\n        } catch (error) {\n            uni.hideLoading()\n            console.error('提交合同失败:', error)\n            uni.showToast({\n                title: '提交失败，请重试',\n                icon: 'none'\n            })\n        }\n\n    } catch (error) {\n        uni.hideLoading()\n        console.error('提交合同失败:', error)\n        uni.showToast({\n            title: '提交失败，请重试',\n            icon: 'none'\n        })\n    }\n}\n\n// 返回上一页\nconst back = () => {\n    // 如果需要返回数据给上级页面，提示用户是否已签名\n    if (needReturnData.value && !signatures.value.partyB) {\n        uni.showToast({\n            title: '请先完成签名',\n            icon: 'none'\n        })\n    }\n\n    uni.navigateBack()\n}\n\n// 页面显示时刷新签名状态\nonMounted(() => {\n    // 监听页面显示事件，刷新签名状态\n    uni.$on('signatureUpdated', (signatureData) => {\n        signatures.value = signatureData\n        updateContractWithSignature()\n\n        // 如果需要返回数据给上级页面，且已签名，才准备返回数据\n        if (needReturnData.value && signatures.value.partyB) {\n            prepareReturnData()\n        }\n    })\n})\n\n// 准备返回给上级页面的数据\nconst prepareReturnData = () => {\n    // 获取当前日期作为开始日期（回显的开始日期）\n    const currentDate = new Date()\n    const year = currentDate.getFullYear()\n    const month = String(currentDate.getMonth() + 1).padStart(2, '0')\n    const day = String(currentDate.getDate()).padStart(2, '0')\n    const createTime = `${year}-${month}-${day}`\n\n    // 准备返回的4个值\n    const returnData = {\n        content: contractContent.value, // 修改后的富文本内容\n        createTime: createTime, // 回显的开始日期\n        endTime: contractData.value.endTime, // 从result.data获取的结束日期\n        id: contractData.value.id // 从result.data获取的合同ID\n    }\n\n    console.log('准备返回给上级页面的数据:', returnData)\n\n    // 通过事件传递数据给上级页面\n    uni.$emit('contractUpdated', returnData)\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.contract-container {\n    min-height: 100vh;\n    background-color: #f5f5f5;\n}\n\n// 合同过期提示样式\n.expired-tip {\n    background: #fff;\n    margin: 20rpx;\n    border-radius: 16rpx;\n    padding: 20rpx;\n    border-left: 4rpx solid #ff9500;\n\n    .tip-content {\n        display: flex;\n        align-items: center;\n        gap: 10rpx;\n\n        .tip-text {\n            font-size: 28rpx;\n            color: #ff9500;\n            font-weight: 500;\n        }\n    }\n}\n\n.contract-content {\n    min-height: calc(100vh - 200rpx);\n    padding: 20rpx;\n    padding-bottom: 140rpx;\n    box-sizing: border-box;\n}\n\n// 当有底部按钮时，增加底部边距\n.contract-container:has(.bottom-actions) .contract-content {\n    padding-bottom: 200rpx;\n}\n\n.contract-header {\n    background: #fff;\n    padding: 30rpx;\n    border-radius: 16rpx;\n    margin-bottom: 20rpx;\n    text-align: center;\n\n    .contract-title {\n        font-size: 36rpx;\n        font-weight: bold;\n        color: #333;\n        display: block;\n        margin-bottom: 20rpx;\n    }\n\n    .contract-date {\n        font-size: 28rpx;\n        color: #666;\n    }\n}\n\n.contract-body {\n    background: #fff;\n    padding: 30rpx;\n    border-radius: 16rpx;\n    margin-bottom: 20rpx;\n    min-height: 800rpx;\n}\n\n.readonly-tip {\n    background: #f8f9fa;\n    border-radius: 8rpx;\n    padding: 20rpx;\n    margin: 20rpx 0;\n    display: flex;\n    align-items: center;\n    gap: 10rpx;\n    border-left: 4rpx solid #ff9500;\n\n}\n\n.bottom-actions {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: #fff;\n    padding: 20rpx 30rpx;\n    padding-bottom: calc(20rpx + env(safe-area-inset-bottom));\n    border-top: 1rpx solid #eee;\n    display: flex;\n    gap: 20rpx;\n    z-index: 100;\n\n    .action-btn {\n        flex: 1;\n        height: 80rpx;\n        border-radius: 40rpx;\n        font-size: 32rpx;\n        font-weight: bold;\n        border: none;\n\n        &.signature-btn {\n            background: #ff9500;\n            color: #fff;\n        }\n\n        &.preview-btn {\n            background: #f0f0f0;\n            color: #666;\n        }\n\n        &.submit-btn {\n            background: linear-gradient(135deg, #07c160 0%, #10ad6a 100%);\n            color: #fff;\n\n            &:disabled {\n                background: #ccc;\n                color: #999;\n            }\n        }\n    }\n}\n\n// 富文本样式调整\n:deep(.rich-text) {\n    font-size: 28rpx;\n    line-height: 1.6;\n    color: #333;\n}\n\n// 底部操作按钮样式\n.bottom-actions {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: #fff;\n    padding: 20rpx 30rpx;\n    padding-bottom: calc(20rpx + env(safe-area-inset-bottom));\n    border-top: 1rpx solid #eee;\n    z-index: 100;\n\n    .action-btn {\n        width: 100%;\n        height: 80rpx;\n        border-radius: 40rpx;\n        font-size: 32rpx;\n        font-weight: bold;\n        border: none;\n\n        &.submit-btn {\n            background: linear-gradient(135deg, #07c160 0%, #10ad6a 100%);\n            color: #fff;\n\n            &:disabled {\n                background: #ccc;\n                color: #999;\n            }\n        }\n    }\n}\n</style>","import MiniProgramPage from '/Users/yx/Documents/Vue3Projects/cycl/pages/syContract/syContract.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","useUserStore","uni","computed","onLoad","apiGetMerchantCovenant","apiGetCovenantTemplat","contractData","apiAddMerchantCovenant","onMounted"],"mappings":"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"}