{"version":3,"file":"shSignature.js","sources":["pages/syContract/shSignature.vue","pages/syContract/shSignature.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"signature-container\">\n        <uni-nav-bar dark :fixed=\"true\" background-color=\"#fff\" status-bar left-icon=\"left\" color=\"#000\"\n            :title=\"contractTitle\" @clickLeft=\"back\" />\n        <!-- 横屏签名弹窗 -->\n        <view class=\"signature-modal-native\">\n            <view style=\"width: 100%; height: 100%;\">\n                <l-signature ref=\"signatureRef\" :penColor=\"penColor\" :penSize=\"penSize\" :openSmooth=\"openSmooth\"\n                    openSmooth></l-signature>\n            </view>\n\n            <view class=\"signature-buttons-rotated\">\n                <button class=\"signature-btn clear-btn\" @click=\"clearSignature\">清空</button>\n                <button class=\"signature-btn undo-btn\" @click=\"undoSignature\">撤销</button>\n                <button class=\"signature-btn save-btn\" @click=\"saveSignature\">保存</button>\n                <button class=\"signature-btn cancel-btn\" @click=\"cancelSignature\">取消</button>\n            </view>\n        </view>\n    </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { onLoad, onUnload } from '@dcloudio/uni-app'\nimport { uploadUrl, createUploadHeaders } from '@/utils/config.js'\n\n// 页面参数\nconst contractId = ref('')\nconst contractTitle = ref('合同签名')\n\n// 签名相关数据\nconst penColor = ref('black')\nconst penSize = ref(3)\nconst openSmooth = ref(true)\nconst signatureRef = ref(null)\n\n// 上传相关\nconst uploadHeaders = createUploadHeaders()\n\n// 页面加载\nonLoad((options) => {\n    contractId.value = options.contractId || ''\n    contractTitle.value = options.title || '合同签名'\n})\n\n// 页面卸载时清理\nonUnload(() => {\n    // 清理工作\n    console.log('签名页面卸载')\n})\n\n// 清空签名\nconst clearSignature = () => {\n    if (signatureRef.value) {\n        try {\n            signatureRef.value.clear()\n        } catch (error) {\n            console.warn('清空签名失败:', error)\n        }\n    }\n}\n\n// 撤销签名\nconst undoSignature = () => {\n    if (signatureRef.value) {\n        try {\n            signatureRef.value.undo()\n        } catch (error) {\n            console.warn('撤销签名失败:', error)\n        }\n    }\n}\n\n// 保存签名\nconst saveSignature = () => {\n    if (!signatureRef.value) {\n        uni.showToast({\n            title: '签名组件未加载',\n            icon: 'none'\n        })\n        return\n    }\n\n    signatureRef.value.canvasToTempFilePath({\n        success: (res) => {\n            if (res.isEmpty) {\n                uni.showToast({\n                    title: '请先进行签名',\n                    icon: 'none'\n                })\n                return\n            }\n\n            // 显示上传中提示\n            uni.showLoading({\n                title: '上传签名中...'\n            })\n\n            // 上传签名到服务器\n            uni.uploadFile({\n                url: uploadUrl,\n                filePath: res.tempFilePath,\n                name: 'file',\n                header: uploadHeaders.value,\n                success: (uploadRes) => {\n                    uni.hideLoading()\n\n\n                    try {\n                        const response = JSON.parse(uploadRes.data)\n                        if (response.code === 200 && response.url) {\n                            uni.showToast({\n                                title: '签名保存成功',\n                                icon: 'success'\n                            })\n                            console.log('签名上传成功:', uploadRes)\n                            // 返回上一页并传递签名数据\n                            setTimeout(() => {\n                                uni.navigateBack({\n                                    delta: 1,\n                                    success: () => {\n                                        // 通过事件传递签名数据\n                                        uni.$emit('signatureUpdated', {\n                                            partyB: response.url\n                                        })\n                                    }\n                                })\n                            }, 1500)\n                        } else {\n                            throw new Error(response.message || '上传失败')\n                        }\n                    } catch (error) {\n                        console.error('解析上传响应失败:', error)\n                        uni.showToast({\n                            title: '上传失败，请重试',\n                            icon: 'none'\n                        })\n                    }\n                },\n                fail: (error) => {\n                    uni.hideLoading()\n                    console.error('上传签名失败:', error)\n                    uni.showToast({\n                        title: '上传失败，请重试',\n                        icon: 'none'\n                    })\n                }\n            })\n        },\n        fail: (error) => {\n            console.error('保存签名失败:', error)\n            uni.showToast({\n                title: '保存签名失败',\n                icon: 'none'\n            })\n        }\n    })\n}\n\n// 取消签名\nconst cancelSignature = () => {\n    uni.showModal({\n        title: '确认取消',\n        content: '确定要取消签名吗？',\n        success: (res) => {\n            if (res.confirm) {\n                uni.navigateBack()\n            }\n        }\n    })\n}\n\n// 返回上一页\nconst back = () => {\n    uni.navigateBack()\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.signature-container {\n    width: 100vw;\n    height: 100vh;\n    background: #f5f5f5;\n}\n\n.signature-modal-native {\n    width: 100vw;\n    height: 100vh;\n    background: #fff;\n    border-radius: 0;\n    overflow: hidden;\n    position: fixed;\n    z-index: 2;\n    top: 0;\n    left: 0;\n\n    .signature-buttons-rotated {\n        position: absolute;\n        right: 20rpx;\n        top: 50%;\n        transform: translateY(-50%);\n        display: flex;\n        flex-direction: column;\n        gap: 15rpx;\n        z-index: 10;\n        background: rgba(255, 255, 255, 0.9);\n        padding: 10rpx;\n\n\n        .signature-btn {\n            height: 25rpx;\n            width: 70rpx;\n            border-radius: 30rpx;\n            font-size: 12rpx;\n            border: none;\n            line-height: 25rpx;\n            text-align: center;\n            background: #07c160;\n            color: #fff;\n\n            // &.clear-btn {\n            //     background: #ff4444;\n            //     color: #fff;\n            // }\n\n            // &.undo-btn {\n            //     background: #ff9500;\n            //     color: #fff;\n            // }\n\n            // &.save-btn {\n            //     background: #07c160;\n            //     color: #fff;\n            // }\n\n            // &.cancel-btn {\n            //     background: #999;\n            //     color: #fff;\n            // }\n        }\n    }\n}\n</style>","import MiniProgramPage from '/Users/yx/Documents/Vue3Projects/cycl/pages/syContract/shSignature.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","createUploadHeaders","onLoad","onUnload","uni","uploadUrl"],"mappings":"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"}