{"version":3,"file":"user.js","sources":["stores/user.js"],"sourcesContent":["// stores/user.js\nimport { defineStore } from 'pinia'\nimport { apiGetInfo } from '@/api/apis.js'\n\nexport const useUserStore = defineStore('user', {\n    state: () => ({\n        userInfo: null,\n        isLoggedIn: false,\n    }),\n\n    getters: {\n        // 用户昵称\n        nickName: (state) => state.userInfo?.nickName || '',\n\n        // 用户名\n        userName: (state) => state.userInfo?.userName || '',\n\n        // 用户ID\n        userId: (state) => state.userInfo?.userId || null,\n\n        //merchant 商户信息\n        merchant: (state) => state.userInfo?.merchant || null,\n\n        // 头像（使用昵称第一个字）\n        userAvatar: (state) => {\n            const nickName = state.userInfo?.nickName\n            // 如果有昵称，取第一个字；如果没有，显示默认头像文字\n            return nickName ? nickName.charAt(0) : '商'\n        },\n\n        // 是否已认证（merchant不为null且status为1表示已认证）\n        isVerified: (state) => state.userInfo?.merchant !== null && state.userInfo?.merchant?.status === 1,\n\n        // 认证状态：0=未审核/待审核，1=认证成功，2=审核不通过\n        merchantStatus: (state) => {\n            if (!state.userInfo?.merchant) {\n                return null // 未提交认证\n            }\n            return state.userInfo.merchant.status\n        },\n\n        // 认证状态文字\n        merchantStatusText: (state) => {\n            const status = state.userInfo?.merchant?.status\n            switch (status) {\n                case 0:\n                    return '待审核'\n                case 1:\n                    return '认证成功'\n                case 2:\n                    return '审核不通过'\n                default:\n                    return '未认证'\n            }\n        },\n\n        // 用户类型（1=商户，2=收运）\n        userType: (state) => state.userInfo?.type || '1',\n\n        // 用户类型文字\n        userTypeText: (state) => {\n            const type = state.userInfo?.type\n            return type === '1' ? '商户端' : type === '2' ? '收运端' : '未知'\n        },\n\n    },\n\n    actions: {\n        // 设置用户信息（仅存储在内存中）\n        setUserInfo(userInfo) {\n            this.userInfo = userInfo\n            this.isLoggedIn = true\n            console.log('完整userInfo对象:', JSON.stringify(userInfo, null, 2))\n        },\n\n        // 从服务器获取用户信息\n        async fetchUserInfo() {\n            try {\n                const res = await apiGetInfo()\n                if (res.code === 200) {\n                    this.setUserInfo(res.user)\n                    console.log('用户信息获取成功:', res.user)\n                    return res.user\n                } else {\n                    console.error('获取用户信息失败:', res.msg)\n                    throw new Error(res.msg || '获取用户信息失败')\n                }\n            } catch (error) {\n                console.error('获取用户信息异常:', error)\n                throw error\n            }\n        },\n\n        // 更新用户信息（仅内存更新）\n        updateUserInfo(updates) {\n            if (this.userInfo) {\n                this.userInfo = { ...this.userInfo, ...updates }\n                console.log('用户信息已更新:', this.userInfo)\n            }\n        },\n\n        // 检查是否有用户信息，没有则自动获取\n        async ensureUserInfo() {\n            // 如果已有用户信息，直接返回\n            if (this.userInfo) {\n                return this.userInfo\n            }\n\n            try {\n                // 尝试获取用户信息（request.js会自动处理token验证）\n                await this.fetchUserInfo()\n                return this.userInfo\n            } catch (error) {\n                console.error('获取用户信息失败:', error)\n                // request.js会自动处理401跳转，这里不需要额外处理\n                throw error\n            }\n        },\n\n        // 清除用户信息\n        clearUserInfo() {\n            this.userInfo = null\n            this.isLoggedIn = false\n            console.log('用户信息已清除')\n        },\n\n        // 退出登录\n        logout() {\n            // 清除用户信息\n            this.clearUserInfo()\n\n            // 清除token\n            uni.removeStorageSync('access_token')\n            uni.removeStorageSync('access_expire_time')\n            uni.removeStorageSync('refresh_token')\n            uni.removeStorageSync('refresh_expire_time')\n\n            console.log('用户已退出登录')\n\n            // 跳转到登录页\n            uni.redirectTo({\n                url: '/pages/index/index'\n            })\n        }\n    }\n})\n"],"names":["defineStore","uni","apiGetInfo"],"mappings":"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"}